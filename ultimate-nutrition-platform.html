<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Ultimate Nutrition Platform - Professional-grade nutrition tracking, meal planning, and health analytics">
    <meta name="keywords" content="nutrition, diet, health, meal planning, calories, macros, fitness">
    <meta name="author" content="Ultimate Nutrition Platform">
    <title>Ultimate Nutrition Platform - Professional Nutrition & Health Analytics</title>
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>ü•ó</text></svg>">
    
    <style>
        /* ===== CSS CUSTOM PROPERTIES & THEMING ===== */
        :root {
            /* Primary Color Palette */
            --primary-50: #f0f9f0;
            --primary-100: #dcf2dc;
            --primary-200: #bae5ba;
            --primary-300: #8dd38d;
            --primary-400: #5cb85c;
            --primary-500: #3e8e3e;
            --primary-600: #2d5a27;
            --primary-700: #1a3b17;
            --primary-800: #0f2e0c;
            --primary-900: #071f05;
            
            /* Secondary Color Palette */
            --secondary-50: #fff8f0;
            --secondary-100: #ffefd9;
            --secondary-200: #ffd7b3;
            --secondary-300: #ffb88a;
            --secondary-400: #ff9761;
            --secondary-500: #ff6b35;
            --secondary-600: #e55a2b;
            --secondary-700: #cc4920;
            --secondary-800: #b23916;
            --secondary-900: #99280b;
            
            /* Neutral Color Palette */
            --neutral-50: #fafafa;
            --neutral-100: #f5f5f5;
            --neutral-200: #e5e5e5;
            --neutral-300: #d4d4d4;
            --neutral-400: #a3a3a3;
            --neutral-500: #737373;
            --neutral-600: #525252;
            --neutral-700: #404040;
            --neutral-800: #262626;
            --neutral-900: #171717;
            
            /* Semantic Colors */
            --success: #22c55e;
            --warning: #f59e0b;
            --error: #ef4444;
            --info: #3b82f6;
            
            /* Theme Variables */
            --bg-primary: var(--neutral-50);
            --bg-secondary: #ffffff;
            --bg-tertiary: var(--neutral-100);
            --text-primary: var(--neutral-900);
            --text-secondary: var(--neutral-600);
            --text-tertiary: var(--neutral-400);
            --border-color: var(--neutral-200);
            --border-hover: var(--neutral-300);
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
            --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);
            
            /* Layout Variables */
            --border-radius: 12px;
            --border-radius-sm: 8px;
            --border-radius-lg: 16px;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --max-width: 1200px;
            --header-height: 72px;
        }
        
        /* Dark Theme */
        [data-theme="dark"] {
            --bg-primary: var(--neutral-900);
            --bg-secondary: var(--neutral-800);
            --bg-tertiary: var(--neutral-700);
            --text-primary: var(--neutral-50);
            --text-secondary: var(--neutral-300);
            --text-tertiary: var(--neutral-400);
            --border-color: var(--neutral-700);
            --border-hover: var(--neutral-600);
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.3);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.3), 0 2px 4px -2px rgb(0 0 0 / 0.3);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.3), 0 4px 6px -4px rgb(0 0 0 / 0.3);
            --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.3), 0 8px 10px -6px rgb(0 0 0 / 0.3);
        }
        
        /* ===== RESET & BASE STYLES ===== */
        *, *::before, *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        html {
            font-size: 16px;
            scroll-behavior: smooth;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            line-height: 1.6;
            color: var(--text-primary);
            background: var(--bg-primary);
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            transition: var(--transition);
        }
        
        /* ===== UTILITY CLASSES ===== */
        .container {
            max-width: var(--max-width);
            margin: 0 auto;
            padding: 0 1rem;
        }
        
        .flex { display: flex; }
        .flex-col { flex-direction: column; }
        .flex-wrap { flex-wrap: wrap; }
        .items-center { align-items: center; }
        .items-start { align-items: flex-start; }
        .justify-center { justify-content: center; }
        .justify-between { justify-content: space-between; }
        .gap-1 { gap: 0.25rem; }
        .gap-2 { gap: 0.5rem; }
        .gap-3 { gap: 0.75rem; }
        .gap-4 { gap: 1rem; }
        .gap-6 { gap: 1.5rem; }
        .gap-8 { gap: 2rem; }
        
        .grid { display: grid; }
        .grid-cols-1 { grid-template-columns: repeat(1, minmax(0, 1fr)); }
        .grid-cols-2 { grid-template-columns: repeat(2, minmax(0, 1fr)); }
        .grid-cols-3 { grid-template-columns: repeat(3, minmax(0, 1fr)); }
        .grid-auto-fit { grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); }
        .grid-auto-fill { grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); }
        
        .p-2 { padding: 0.5rem; }
        .p-3 { padding: 0.75rem; }
        .p-4 { padding: 1rem; }
        .p-6 { padding: 1.5rem; }
        .p-8 { padding: 2rem; }
        .px-4 { padding-left: 1rem; padding-right: 1rem; }
        .py-2 { padding-top: 0.5rem; padding-bottom: 0.5rem; }
        .py-4 { padding-top: 1rem; padding-bottom: 1rem; }
        
        .m-2 { margin: 0.5rem; }
        .m-4 { margin: 1rem; }
        .mb-2 { margin-bottom: 0.5rem; }
        .mb-4 { margin-bottom: 1rem; }
        .mb-6 { margin-bottom: 1.5rem; }
        .mb-8 { margin-bottom: 2rem; }
        .mt-4 { margin-top: 1rem; }
        .mt-6 { margin-top: 1.5rem; }
        .mt-8 { margin-top: 2rem; }
        
        .w-full { width: 100%; }
        .h-full { height: 100%; }
        .min-h-screen { min-height: 100vh; }
        
        .text-sm { font-size: 0.875rem; }
        .text-base { font-size: 1rem; }
        .text-lg { font-size: 1.125rem; }
        .text-xl { font-size: 1.25rem; }
        .text-2xl { font-size: 1.5rem; }
        .text-3xl { font-size: 1.875rem; }
        .text-4xl { font-size: 2.25rem; }
        .font-medium { font-weight: 500; }
        .font-semibold { font-weight: 600; }
        .font-bold { font-weight: 700; }
        .text-center { text-align: center; }
        
        .rounded { border-radius: var(--border-radius-sm); }
        .rounded-lg { border-radius: var(--border-radius); }
        .rounded-xl { border-radius: var(--border-radius-lg); }
        .rounded-full { border-radius: 9999px; }
        
        .shadow-sm { box-shadow: var(--shadow-sm); }
        .shadow-md { box-shadow: var(--shadow-md); }
        .shadow-lg { box-shadow: var(--shadow-lg); }
        .shadow-xl { box-shadow: var(--shadow-xl); }
        
        .transition-all { transition: var(--transition); }
        .cursor-pointer { cursor: pointer; }
        .select-none { user-select: none; }
        
        .hidden { display: none !important; }
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }
        
        /* ===== COMPONENT STYLES ===== */
        
        /* Header */
        .header {
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-color);
            box-shadow: var(--shadow-sm);
            position: sticky;
            top: 0;
            z-index: 1000;
            height: var(--header-height);
        }
        
        .header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            height: 100%;
            gap: 1rem;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-600);
            text-decoration: none;
        }
        
        .logo-icon {
            font-size: 2rem;
        }
        
        /* Navigation */
        .nav {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            flex-wrap: wrap;
        }
        
        .nav-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            border-radius: var(--border-radius-sm);
            background: transparent;
            border: 1px solid transparent;
            color: var(--text-secondary);
            text-decoration: none;
            font-weight: 500;
            font-size: 0.875rem;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .nav-item:hover {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border-color: var(--border-color);
        }
        
        .nav-item.active {
            background: var(--primary-100);
            color: var(--primary-700);
            border-color: var(--primary-200);
        }
        
        [data-theme="dark"] .nav-item.active {
            background: var(--primary-800);
            color: var(--primary-200);
            border-color: var(--primary-700);
        }
        
        /* Buttons */
        .btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1.5rem;
            border-radius: var(--border-radius);
            font-weight: 600;
            font-size: 0.875rem;
            text-decoration: none;
            border: none;
            cursor: pointer;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }
        
        .btn-primary {
            background: var(--primary-600);
            color: white;
        }
        
        .btn-primary:hover {
            background: var(--primary-700);
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }
        
        .btn-secondary {
            background: var(--secondary-500);
            color: white;
        }
        
        .btn-secondary:hover {
            background: var(--secondary-600);
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }
        
        .btn-success {
            background: var(--success);
            color: white;
        }
        
        .btn-success:hover {
            background: #16a34a;
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }
        
        .btn-outline {
            background: transparent;
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }
        
        .btn-outline:hover {
            background: var(--bg-tertiary);
            border-color: var(--border-hover);
            transform: translateY(-2px);
        }
        
        .btn-sm {
            padding: 0.5rem 1rem;
            font-size: 0.8125rem;
        }
        
        .btn-lg {
            padding: 1rem 2rem;
            font-size: 1rem;
        }
        
        /* Cards */
        .card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-sm);
            overflow: hidden;
            transition: var(--transition);
        }
        
        .card:hover {
            box-shadow: var(--shadow-md);
            transform: translateY(-2px);
        }
        
        .card-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 1rem;
        }
        
        .card-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        .card-content {
            padding: 1.5rem;
        }
        
        .card-footer {
            padding: 1rem 1.5rem;
            border-top: 1px solid var(--border-color);
            background: var(--bg-tertiary);
        }
        
        /* Forms */
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            font-size: 0.875rem;
            color: var(--text-primary);
        }
        
        .form-control {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-sm);
            background: var(--bg-secondary);
            color: var(--text-primary);
            font-size: 0.875rem;
            transition: var(--transition);
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--primary-500);
            box-shadow: 0 0 0 3px rgb(62 142 62 / 0.1);
        }
        
        .form-control::placeholder {
            color: var(--text-tertiary);
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1rem;
        }
        
        @media (min-width: 640px) {
            .form-row {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        /* Progress Bar */
        .progress-bar {
            width: 100%;
            height: 8px;
            background: var(--bg-tertiary);
            border-radius: 4px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-500), var(--primary-400));
            border-radius: 4px;
            transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
        }
        
        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            animation: shimmer 2s infinite;
        }
        
        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        
        /* Stats Cards */
        .stat-card {
            background: linear-gradient(135deg, var(--primary-500), var(--primary-600));
            color: white;
            padding: 1.5rem;
            border-radius: var(--border-radius);
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.1), transparent);
            transform: translateX(-100%);
            animation: stat-shine 3s infinite;
        }
        
        @keyframes stat-shine {
            0% { transform: translateX(-100%); }
            50% { transform: translateX(100%); }
            100% { transform: translateX(100%); }
        }
        
        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.25rem;
            display: block;
        }
        
        .stat-label {
            font-size: 0.875rem;
            opacity: 0.9;
        }
        
        .stat-subtitle {
            font-size: 0.75rem;
            opacity: 0.7;
            margin-top: 0.25rem;
        }
        
        /* Alerts */
        .alert {
            padding: 1rem 1.25rem;
            border-radius: var(--border-radius);
            border-left: 4px solid;
            margin-bottom: 1rem;
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
        }
        
        .alert-success {
            background: rgb(34 197 94 / 0.1);
            border-color: var(--success);
            color: #15803d;
        }
        
        .alert-warning {
            background: rgb(245 158 11 / 0.1);
            border-color: var(--warning);
            color: #a16207;
        }
        
        .alert-error {
            background: rgb(239 68 68 / 0.1);
            border-color: var(--error);
            color: #dc2626;
        }
        
        .alert-info {
            background: rgb(59 130 246 / 0.1);
            border-color: var(--info);
            color: #1d4ed8;
        }
        
        /* Modal */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
            z-index: 2000;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
        }
        
        .modal.active {
            opacity: 1;
            visibility: visible;
        }
        
        .modal-content {
            background: var(--bg-secondary);
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow-xl);
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            transform: translateY(20px) scale(0.95);
            transition: var(--transition);
        }
        
        .modal.active .modal-content {
            transform: translateY(0) scale(1);
        }
        
        .modal-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .modal-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--text-primary);
        }
        
        .modal-close {
            width: 32px;
            height: 32px;
            border: none;
            background: none;
            color: var(--text-secondary);
            cursor: pointer;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }
        
        .modal-close:hover {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }
        
        .modal-body {
            padding: 1.5rem;
        }
        
        .modal-footer {
            padding: 1rem 1.5rem;
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: flex-end;
            gap: 0.75rem;
        }
        
        /* Main Content */
        .main {
            padding: 2rem 0;
            min-height: calc(100vh - var(--header-height));
        }
        
        .section {
            display: none;
            animation: fadeIn 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .section.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* Dashboard Grid */
        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                padding: 0 1rem;
            }
            
            .header-content {
                flex-direction: column;
                gap: 0.5rem;
                padding: 0.5rem 0;
            }
            
            .nav {
                width: 100%;
                justify-content: center;
            }
            
            .nav-item {
                font-size: 0.8125rem;
                padding: 0.5rem 0.75rem;
            }
            
            .dashboard {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .modal-content {
                margin: 1rem;
                max-height: calc(100vh - 2rem);
            }
        }
        
        @media (max-width: 480px) {
            .btn {
                padding: 0.625rem 1.25rem;
                font-size: 0.8125rem;
            }
            
            .card-header {
                padding: 1rem;
                flex-direction: column;
                align-items: stretch;
                gap: 0.75rem;
            }
            
            .card-content {
                padding: 1rem;
            }
        }
        
        /* Loading States */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .skeleton {
            background: linear-gradient(90deg, var(--bg-tertiary) 25%, var(--border-color) 50%, var(--bg-tertiary) 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
        }
        
        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }
        
        /* Meal Planner Styles */
        .meal-plan-grid {
            display: grid;
            gap: 1rem;
        }
        
        .day-column {
            background: var(--bg-secondary);
            border-radius: var(--radius-md);
            padding: 1rem;
            border: 1px solid var(--border-color);
        }
        
        .day-header {
            font-weight: 600;
            font-size: 1.125rem;
            color: var(--text-primary);
            margin-bottom: 0.75rem;
            text-align: center;
            padding: 0.5rem;
            background: var(--primary-50);
            border-radius: var(--radius-sm);
            border: 1px solid var(--primary-200);
        }
        
        [data-theme="dark"] .day-header {
            background: var(--primary-900);
            border-color: var(--primary-700);
        }
        
        .meal-slot {
            background: var(--bg-primary);
            border: 2px dashed var(--border-color);
            border-radius: var(--radius-sm);
            padding: 1rem;
            margin-bottom: 0.5rem;
            min-height: 80px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .meal-slot:hover {
            border-color: var(--primary-400);
            background: var(--primary-25);
        }
        
        .meal-slot.filled {
            border: 1px solid var(--success-300);
            background: var(--success-25);
            border-style: solid;
        }
        
        .meal-card {
            width: 100%;
            text-align: left;
        }
        
        .meal-name {
            font-weight: 600;
            color: var(--text-primary);
            font-size: 0.875rem;
            margin-bottom: 0.25rem;
        }
        
        .meal-stats {
            display: flex;
            justify-content: space-between;
            font-size: 0.75rem;
            color: var(--text-secondary);
        }
        
        .meal-calories {
            color: var(--warning-600);
            font-weight: 500;
        }
        
        .recipe-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1rem;
        }
        
        .recipe-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            overflow: hidden;
            transition: all 0.2s ease;
            cursor: pointer;
        }
        
        .recipe-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
            border-color: var(--primary-300);
        }
        
        .recipe-image {
            width: 100%;
            height: 160px;
            background: linear-gradient(135deg, var(--primary-100), var(--primary-200));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            color: var(--primary-600);
        }
        
        .recipe-content {
            padding: 1rem;
        }
        
        .recipe-title {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
            font-size: 1.125rem;
        }
        
        .recipe-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.75rem;
        }
        
        .recipe-time {
            color: var(--text-secondary);
            font-size: 0.875rem;
        }
        
        .recipe-difficulty {
            background: var(--warning-100);
            color: var(--warning-700);
            padding: 0.25rem 0.5rem;
            border-radius: var(--radius-sm);
            font-size: 0.75rem;
            font-weight: 500;
        }
        
        .recipe-nutrition {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.5rem;
            margin-bottom: 0.75rem;
        }
        
        .nutrition-item {
            text-align: center;
        }
        
        .nutrition-value {
            font-weight: 600;
            color: var(--text-primary);
            font-size: 0.875rem;
        }
        
        .nutrition-label {
            color: var(--text-secondary);
            font-size: 0.75rem;
        }
        
        .recipe-tags {
            display: flex;
            gap: 0.25rem;
            flex-wrap: wrap;
        }
        
        .recipe-tag {
            background: var(--primary-100);
            color: var(--primary-700);
            padding: 0.25rem 0.5rem;
            border-radius: var(--radius-sm);
            font-size: 0.75rem;
        }
        
        .grocery-categories {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
        }
        
        .grocery-category {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            padding: 1rem;
        }
        
        .category-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 0.75rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid var(--border-color);
        }
        
        .category-title {
            font-weight: 600;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .category-count {
            background: var(--primary-100);
            color: var(--primary-700);
            padding: 0.25rem 0.5rem;
            border-radius: var(--radius-sm);
            font-size: 0.75rem;
            font-weight: 500;
        }
        
        .grocery-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.5rem 0;
            border-bottom: 1px solid var(--border-light);
        }
        
        .grocery-item:last-child {
            border-bottom: none;
        }
        
        .item-info {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        .item-checkbox {
            width: 16px;
            height: 16px;
            cursor: pointer;
        }
        
        .item-name {
            color: var(--text-primary);
            font-weight: 500;
        }
        
        .item-amount {
            color: var(--text-secondary);
            font-size: 0.875rem;
        }
        
        .item-price {
            color: var(--success-600);
            font-weight: 500;
            font-size: 0.875rem;
        }
        
        .tag-container {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            align-items: center;
        }
        
        .tag {
            background: var(--primary-100);
            color: var(--primary-700);
            padding: 0.375rem 0.75rem;
            border-radius: var(--radius-full);
            font-size: 0.875rem;
            font-weight: 500;
        }
        
        .tag-removable {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
        }
        
        .tag-remove {
            color: var(--danger-600);
            font-weight: bold;
        }
        
        .tag-removable:hover {
            background: var(--danger-100);
            color: var(--danger-700);
        }
        
        /* Responsive meal planner */
        @media (max-width: 1200px) {
            .meal-plan-grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }
        
        @media (max-width: 768px) {
            .meal-plan-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .recipe-grid {
                grid-template-columns: 1fr;
            }
            
            .grocery-categories {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 480px) {
            .meal-plan-grid {
                grid-template-columns: 1fr;
            }
        }
        
        /* Analytics & Progress Styles */
        .analytics-metric {
            display: flex;
            align-items: center;
            gap: 1rem;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            padding: 1.5rem;
        }
        
        .metric-icon {
            font-size: 2rem;
            width: 3rem;
            height: 3rem;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--primary-100);
            border-radius: var(--radius-md);
        }
        
        [data-theme="dark"] .metric-icon {
            background: var(--primary-900);
        }
        
        .metric-content {
            flex: 1;
        }
        
        .metric-value {
            font-size: 1.875rem;
            font-weight: 700;
            color: var(--text-primary);
            line-height: 1.2;
        }
        
        .metric-label {
            color: var(--text-secondary);
            font-size: 0.875rem;
            margin-bottom: 0.25rem;
        }
        
        .metric-trend {
            font-size: 0.75rem;
            font-weight: 500;
            margin-top: 0.25rem;
        }
        
        .metric-trend.positive {
            color: var(--success-600);
        }
        
        .metric-trend.negative {
            color: var(--danger-600);
        }
        
        .metric-trend.neutral {
            color: var(--text-secondary);
        }
        
        .chart-container {
            position: relative;
            height: 300px;
            background: var(--bg-tertiary);
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 1rem;
        }
        
        .chart-container canvas {
            max-width: 100%;
            max-height: 100%;
        }
        
        .chart-stats {
            display: flex;
            justify-content: space-between;
            gap: 1rem;
        }
        
        .stat {
            text-align: center;
            flex: 1;
        }
        
        .stat-label {
            color: var(--text-secondary);
            font-size: 0.875rem;
            display: block;
        }
        
        .stat-value {
            color: var(--text-primary);
            font-weight: 600;
            font-size: 1.125rem;
        }
        
        .calorie-breakdown {
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
            flex-wrap: wrap;
        }
        
        .breakdown-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
            color: var(--text-secondary);
        }
        
        .breakdown-color {
            width: 0.75rem;
            height: 0.75rem;
            border-radius: 50%;
        }
        
        .nutrition-view {
            animation: fadeIn 0.3s ease;
        }
        
        .nutrition-view.hidden {
            display: none;
        }
        
        .macro-analysis {
            text-align: center;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            padding: 1.5rem;
        }
        
        .macro-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 1rem;
        }
        
        .macro-chart {
            margin-bottom: 1rem;
        }
        
        .macro-ring {
            position: relative;
            width: 120px;
            height: 120px;
            margin: 0 auto 1rem;
            border-radius: 50%;
            background: conic-gradient(
                var(--primary-500) calc(var(--progress) * 1%), 
                var(--border-color) calc(var(--progress) * 1%)
            );
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .macro-ring::before {
            content: '';
            position: absolute;
            width: 80px;
            height: 80px;
            background: var(--bg-primary);
            border-radius: 50%;
        }
        
        .macro-value, .macro-target {
            position: relative;
            z-index: 1;
        }
        
        .macro-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-primary);
        }
        
        .macro-target {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }
        
        .macro-stats {
            color: var(--text-secondary);
            font-size: 0.875rem;
            line-height: 1.5;
        }
        
        .micronutrient-grid {
            display: grid;
            gap: 1rem;
        }
        
        .micro-item {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            padding: 1rem;
        }
        
        .micro-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.75rem;
        }
        
        .micro-name {
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .micro-status {
            padding: 0.25rem 0.5rem;
            border-radius: var(--radius-sm);
            font-size: 0.75rem;
            font-weight: 500;
        }
        
        .micro-status.excellent {
            background: var(--success-100);
            color: var(--success-700);
        }
        
        .micro-status.good {
            background: var(--primary-100);
            color: var(--primary-700);
        }
        
        .micro-status.warning {
            background: var(--warning-100);
            color: var(--warning-700);
        }
        
        .micro-bar {
            background: var(--border-color);
            height: 0.5rem;
            border-radius: var(--radius-sm);
            overflow: hidden;
            margin-bottom: 0.5rem;
        }
        
        .micro-progress {
            height: 100%;
            background: var(--primary-500);
            border-radius: var(--radius-sm);
            transition: width 0.3s ease;
        }
        
        .micro-details {
            color: var(--text-secondary);
            font-size: 0.875rem;
        }
        
        .meal-timing-analysis h3 {
            color: var(--text-primary);
            margin-bottom: 1.5rem;
            text-align: center;
        }
        
        .timing-chart {
            background: var(--bg-secondary);
            border-radius: var(--radius-md);
            padding: 2rem;
            margin-bottom: 2rem;
        }
        
        .timeline {
            position: relative;
            height: 60px;
            background: linear-gradient(to right, var(--primary-200), var(--primary-300), var(--primary-200));
            border-radius: var(--radius-full);
        }
        
        .time-marker {
            position: absolute;
            top: -20px;
        }
        
        .time-label {
            font-size: 0.75rem;
            color: var(--text-secondary);
            text-align: center;
            margin-bottom: 0.5rem;
        }
        
        .meal-marker {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            color: white;
            font-weight: 600;
            position: relative;
            cursor: pointer;
        }
        
        .meal-marker.breakfast { background: var(--warning-500); }
        .meal-marker.lunch { background: var(--success-500); }
        .meal-marker.dinner { background: var(--primary-500); }
        .meal-marker.snack { background: var(--secondary-500); }
        
        .meal-info {
            position: absolute;
            top: 50px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-sm);
            padding: 0.5rem;
            font-size: 0.75rem;
            text-align: center;
            white-space: nowrap;
            color: var(--text-primary);
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .meal-marker:hover .meal-info {
            opacity: 1;
        }
        
        .timing-insights {
            display: grid;
            gap: 0.75rem;
        }
        
        .insight {
            padding: 0.75rem;
            border-radius: var(--radius-md);
            font-size: 0.875rem;
        }
        
        .insight.positive {
            background: var(--success-50);
            color: var(--success-700);
            border: 1px solid var(--success-200);
        }
        
        .insight.warning {
            background: var(--warning-50);
            color: var(--warning-700);
            border: 1px solid var(--warning-200);
        }
        
        .insight.negative {
            background: var(--danger-50);
            color: var(--danger-700);
            border: 1px solid var(--danger-200);
        }
        
        [data-theme="dark"] .insight.positive {
            background: var(--success-900);
            color: var(--success-200);
            border-color: var(--success-700);
        }
        
        [data-theme="dark"] .insight.warning {
            background: var(--warning-900);
            color: var(--warning-200);
            border-color: var(--warning-700);
        }
        
        .habits-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
        }
        
        .habit-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            padding: 1.5rem;
            transition: all 0.2s ease;
        }
        
        .habit-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }
        
        .habit-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        
        .habit-name {
            font-weight: 600;
            color: var(--text-primary);
            font-size: 1.125rem;
        }
        
        .habit-streak {
            background: var(--primary-100);
            color: var(--primary-700);
            padding: 0.25rem 0.5rem;
            border-radius: var(--radius-sm);
            font-size: 0.75rem;
            font-weight: 500;
        }
        
        .habit-progress {
            margin-bottom: 1rem;
        }
        
        .progress-bar {
            background: var(--border-color);
            height: 0.5rem;
            border-radius: var(--radius-full);
            overflow: hidden;
            margin-bottom: 0.5rem;
        }
        
        .progress-fill {
            height: 100%;
            background: var(--primary-500);
            border-radius: var(--radius-full);
            transition: width 0.3s ease;
        }
        
        .progress-text {
            color: var(--text-secondary);
            font-size: 0.875rem;
        }
        
        .habit-actions {
            display: flex;
            gap: 0.5rem;
        }
        
        .sleep-rating {
            text-align: center;
        }
        
        .stars {
            color: var(--warning-500);
            font-size: 1.25rem;
            margin-bottom: 0.5rem;
        }
        
        .sleep-duration {
            color: var(--text-secondary);
            font-size: 0.875rem;
        }
        
        .insights-container {
            display: grid;
            gap: 1rem;
        }
        
        .insight-card {
            display: flex;
            gap: 1rem;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            padding: 1.5rem;
            transition: all 0.2s ease;
        }
        
        .insight-card:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-sm);
        }
        
        .insight-card.priority-high {
            border-left: 4px solid var(--danger-500);
        }
        
        .insight-card.priority-medium {
            border-left: 4px solid var(--warning-500);
        }
        
        .insight-card.priority-low {
            border-left: 4px solid var(--success-500);
        }
        
        .insight-icon {
            font-size: 2rem;
            width: 3rem;
            height: 3rem;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--bg-tertiary);
            border-radius: var(--radius-md);
            flex-shrink: 0;
        }
        
        .insight-content {
            flex: 1;
        }
        
        .insight-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }
        
        .insight-description {
            color: var(--text-secondary);
            margin-bottom: 1rem;
            line-height: 1.5;
        }
        
        .insight-actions {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }
        
        /* Responsive analytics */
        @media (max-width: 1024px) {
            .habits-grid {
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            }
        }
        
        @media (max-width: 768px) {
            .grid.grid-4 {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .analytics-metric {
                padding: 1rem;
                gap: 0.75rem;
            }
            
            .metric-icon {
                font-size: 1.5rem;
                width: 2.5rem;
                height: 2.5rem;
            }
            
            .metric-value {
                font-size: 1.5rem;
            }
            
            .chart-container {
                height: 200px;
            }
            
            .habits-grid {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 480px) {
            .grid.grid-4 {
                grid-template-columns: 1fr;
            }
            
            .calorie-breakdown {
                flex-direction: column;
            }
            
            .insight-card {
                flex-direction: column;
                text-align: center;
            }
            
            .insight-actions {
                justify-content: center;
            }
        }
        
        /* Animation for chart loading */
        @keyframes chartLoad {
            from { opacity: 0; transform: scale(0.8); }
            to { opacity: 1; transform: scale(1); }
        }
        
        .chart-container {
            animation: chartLoad 0.5s ease;
        }
        
        /* Print Styles */
        @media print {
            .header, .nav, .btn, .modal {
                display: none !important;
            }
            
            .card {
                break-inside: avoid;
                box-shadow: none;
                border: 1px solid #000;
            }
            
            .section {
                display: block !important;
            }
        }
        
        /* High Contrast Mode */
        @media (prefers-contrast: high) {
            :root {
                --border-color: #000000;
                --text-secondary: #000000;
            }
            
            [data-theme="dark"] {
                --border-color: #ffffff;
                --text-secondary: #ffffff;
            }
        }
        
        /* Reduced Motion */
        @media (prefers-reduced-motion: reduce) {
            *, *::before, *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
                scroll-behavior: auto !important;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header" role="banner">
        <div class="container">
            <div class="header-content">
                <a href="#" class="logo" onclick="showSection('dashboard')" aria-label="Ultimate Nutrition Platform - Go to Dashboard">
                    <span class="logo-icon">ü•ó</span>
                    <span>Ultimate Nutrition Platform</span>
                </a>
                
                <nav class="nav" role="navigation" aria-label="Main navigation">
                    <a href="#dashboard" class="nav-item active" onclick="showSection('dashboard')" data-section="dashboard">
                        <span>üìä</span> Dashboard
                    </a>
                    <a href="#calculators" class="nav-item" onclick="showSection('calculators')" data-section="calculators">
                        <span>üßÆ</span> Calculators
                    </a>
                    <a href="#food-tracker" class="nav-item" onclick="showSection('food-tracker')" data-section="food-tracker">
                        <span>üçΩÔ∏è</span> Food Tracker
                    </a>
                    <a href="#meal-planner" class="nav-item" onclick="showSection('meal-planner')" data-section="meal-planner">
                        <span>üìÖ</span> Meal Planner
                    </a>
                    <a href="#progress" class="nav-item" onclick="showSection('progress')" data-section="progress">
                        <span>üìà</span> Progress
                    </a>
                    <a href="#professional" class="nav-item" onclick="showSection('professional')" data-section="professional">
                        <span>üë©‚Äç‚öïÔ∏è</span> Professional
                    </a>
                    <button class="nav-item" onclick="toggleTheme()" id="theme-toggle" aria-label="Toggle dark mode">
                        <span>üåô</span> Dark Mode
                    </button>
                </nav>
            </div>
        </div>
    </header>
    
    <!-- Main Content -->
    <main class="main" role="main">
        <div class="container">
            <!-- Dashboard Section -->
            <section id="dashboard" class="section active" role="tabpanel" aria-labelledby="dashboard-tab">
                <div class="dashboard">
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">üìä Today's Overview</h2>
                            <button class="btn btn-outline btn-sm" onclick="refreshDashboard()">
                                <span>üîÑ</span> Refresh
                            </button>
                        </div>
                        <div class="card-content">
                            <div class="grid grid-cols-2 gap-4 mb-6">
                                <div class="stat-card">
                                    <span class="stat-number" id="daily-calories">0</span>
                                    <span class="stat-label">Calories</span>
                                    <span class="stat-subtitle" id="calorie-goal">Goal: 2000</span>
                                </div>
                                <div class="stat-card" style="background: linear-gradient(135deg, var(--info), #2563eb);">
                                    <span class="stat-number" id="daily-protein">0g</span>
                                    <span class="stat-label">Protein</span>
                                    <span class="stat-subtitle" id="protein-goal">Goal: 150g</span>
                                </div>
                                <div class="stat-card" style="background: linear-gradient(135deg, var(--success), #16a34a);">
                                    <span class="stat-number" id="daily-water">0.0L</span>
                                    <span class="stat-label">Water</span>
                                    <span class="stat-subtitle">Goal: 2.5L</span>
                                </div>
                                <div class="stat-card" style="background: linear-gradient(135deg, var(--warning), #d97706);">
                                    <span class="stat-number" id="streak-days">0</span>
                                    <span class="stat-label">Streak</span>
                                    <span class="stat-subtitle">Days logging</span>
                                </div>
                            </div>
                            
                            <div class="mb-4">
                                <label class="form-label">Calorie Goal Progress</label>
                                <div class="progress-bar">
                                    <div class="progress-fill" id="calorie-progress" style="width: 0%"></div>
                                </div>
                                <div class="flex justify-between text-sm mt-1">
                                    <span id="calories-consumed">0 consumed</span>
                                    <span id="calories-remaining">2000 remaining</span>
                                </div>
                            </div>
                            
                            <div class="flex gap-2">
                                <button class="btn btn-primary btn-sm" onclick="showSection('food-tracker')">
                                    <span>üçΩÔ∏è</span> Log Food
                                </button>
                                <button class="btn btn-success btn-sm" onclick="logWater()">
                                    <span>üíß</span> Add Water
                                </button>
                                <button class="btn btn-outline btn-sm" onclick="showSection('calculators')">
                                    <span>üßÆ</span> Calculate
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">üéØ Quick Goals</h2>
                        </div>
                        <div class="card-content">
                            <div class="form-group">
                                <label for="user-goal" class="form-label">Current Goal:</label>
                                <select class="form-control" id="user-goal" onchange="updateGoalMetrics()">
                                    <option value="weight-loss">Weight Loss</option>
                                    <option value="muscle-gain">Muscle Gain</option>
                                    <option value="maintenance">Maintenance</option>
                                    <option value="athletic-performance">Athletic Performance</option>
                                    <option value="health-condition">Health Condition Management</option>
                                </select>
                            </div>
                            
                            <div class="flex flex-wrap gap-2 mb-4">
                                <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-yellow-100 text-yellow-800">
                                    üî• 7 Day Streak
                                </span>
                                <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-blue-100 text-blue-800">
                                    üíß Hydration Master
                                </span>
                                <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-green-100 text-green-800">
                                    ü•¨ Veggie Lover
                                </span>
                            </div>
                            
                            <div class="alert alert-info">
                                <div>
                                    <strong>üí° Today's Tip:</strong><br>
                                    <span id="daily-tip">Aim to include a source of protein with every meal to help maintain stable blood sugar levels.</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">üì± Quick Actions</h2>
                        </div>
                        <div class="card-content">
                            <div class="grid grid-cols-1 gap-3">
                                <button class="btn btn-primary w-full" onclick="showSection('food-tracker')">
                                    <span>üì∏</span> Photo Food Log
                                </button>
                                <button class="btn btn-secondary w-full" onclick="openBarcodeScanner()">
                                    <span>üì±</span> Scan Barcode
                                </button>
                                <button class="btn btn-success w-full" onclick="startVoiceInput()">
                                    <span>üé§</span> Voice Input
                                </button>
                                <button class="btn btn-outline w-full" onclick="showSection('meal-planner')">
                                    <span>üé≤</span> Generate Meal Plan
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="card mt-8">
                    <div class="card-header">
                        <h2 class="card-title">üìà Recent Activity</h2>
                        <button class="btn btn-outline btn-sm" onclick="showSection('progress')">View All</button>
                    </div>
                    <div class="card-content">
                        <div id="recent-activity">
                            <p class="text-center text-gray-500">Start logging your meals to see your activity here!</p>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- Calculators Section -->
            <section id="calculators" class="section" role="tabpanel" aria-labelledby="calculators-tab">
                <div class="dashboard">
                    <!-- BMI Calculator -->
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">‚öñÔ∏è BMI Calculator</h2>
                            <select class="btn btn-outline btn-sm" id="bmi-units" onchange="toggleUnits('bmi')">
                                <option value="metric">Metric</option>
                                <option value="imperial">Imperial</option>
                            </select>
                        </div>
                        <div class="card-content">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="bmi-weight" class="form-label">Weight</label>
                                    <div class="flex gap-2">
                                        <input type="number" class="form-control" id="bmi-weight" placeholder="70" step="0.1" min="1">
                                        <span class="flex items-center px-3 text-sm font-medium" id="bmi-weight-unit">kg</span>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="bmi-height" class="form-label">Height</label>
                                    <div class="flex gap-2">
                                        <input type="number" class="form-control" id="bmi-height" placeholder="175" step="0.1" min="1">
                                        <span class="flex items-center px-3 text-sm font-medium" id="bmi-height-unit">cm</span>
                                    </div>
                                </div>
                            </div>
                            <button class="btn btn-primary w-full" onclick="calculateBMI()">Calculate BMI</button>
                            <div id="bmi-result" class="mt-4"></div>
                        </div>
                    </div>
                    
                    <!-- BMR & TDEE Calculator -->
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">üî• BMR & TDEE Calculator</h2>
                            <select class="btn btn-outline btn-sm" id="bmr-formula" onchange="toggleBodyFatInput()">
                                <option value="mifflin">Mifflin-St Jeor</option>
                                <option value="harris">Harris-Benedict</option>
                                <option value="katch">Katch-McArdle</option>
                            </select>
                        </div>
                        <div class="card-content">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="bmr-age" class="form-label">Age (years)</label>
                                    <input type="number" class="form-control" id="bmr-age" placeholder="30" min="10" max="100">
                                </div>
                                <div class="form-group">
                                    <label for="bmr-gender" class="form-label">Biological Sex</label>
                                    <select class="form-control" id="bmr-gender">
                                        <option value="male">Male</option>
                                        <option value="female">Female</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="bmr-weight" class="form-label">Weight (kg)</label>
                                    <input type="number" class="form-control" id="bmr-weight" placeholder="70" step="0.1" min="1">
                                </div>
                                <div class="form-group">
                                    <label for="bmr-height" class="form-label">Height (cm)</label>
                                    <input type="number" class="form-control" id="bmr-height" placeholder="175" step="0.1" min="1">
                                </div>
                            </div>
                            <div class="form-group" id="body-fat-group" style="display: none;">
                                <label for="bmr-body-fat" class="form-label">Body Fat Percentage (%)</label>
                                <input type="number" class="form-control" id="bmr-body-fat" placeholder="15" step="0.1" min="5" max="50">
                                <small class="text-sm text-gray-500 mt-1">Required for Katch-McArdle formula</small>
                            </div>
                            <div class="form-group">
                                <label for="activity-level" class="form-label">Activity Level</label>
                                <select class="form-control" id="activity-level">
                                    <option value="1.2">Sedentary (little/no exercise)</option>
                                    <option value="1.375">Light (light exercise 1-3 days/week)</option>
                                    <option value="1.55">Moderate (moderate exercise 3-5 days/week)</option>
                                    <option value="1.725">Very Active (hard exercise 6-7 days/week)</option>
                                    <option value="1.9">Extra Active (very hard exercise, physical job)</option>
                                </select>
                            </div>
                            <button class="btn btn-primary w-full" onclick="calculateBMR()">Calculate BMR & TDEE</button>
                            <div id="bmr-result" class="mt-4"></div>
                        </div>
                    </div>
                    
                    <!-- Macro Calculator -->
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">üçØ Macro Calculator</h2>
                            <select class="btn btn-outline btn-sm" id="macro-preset" onchange="applyMacroPreset()">
                                <option value="custom">Custom</option>
                                <option value="balanced">Balanced</option>
                                <option value="keto">Ketogenic</option>
                                <option value="paleo">Paleo</option>
                                <option value="mediterranean">Mediterranean</option>
                                <option value="dash">DASH</option>
                                <option value="high-protein">High Protein</option>
                                <option value="low-carb">Low Carb</option>
                            </select>
                        </div>
                        <div class="card-content">
                            <div class="form-group">
                                <label for="macro-calories" class="form-label">Daily Calories</label>
                                <input type="number" class="form-control" id="macro-calories" placeholder="2000" min="1000" max="5000">
                                <small class="text-sm text-gray-500 mt-1">Use TDEE from calculator above or enter custom value</small>
                            </div>
                            
                            <div class="grid grid-cols-3 gap-4 mb-6">
                                <div class="form-group">
                                    <label for="carb-percent" class="form-label">Carbs (%)</label>
                                    <input type="number" class="form-control" id="carb-percent" value="40" min="0" max="100" oninput="validateMacroPercentages()">
                                </div>
                                <div class="form-group">
                                    <label for="protein-percent" class="form-label">Protein (%)</label>
                                    <input type="number" class="form-control" id="protein-percent" value="30" min="0" max="100" oninput="validateMacroPercentages()">
                                </div>
                                <div class="form-group">
                                    <label for="fat-percent" class="form-label">Fat (%)</label>
                                    <input type="number" class="form-control" id="fat-percent" value="30" min="0" max="100" oninput="validateMacroPercentages()">
                                </div>
                            </div>
                            
                            <div id="macro-validation" class="mb-4"></div>
                            <button class="btn btn-primary w-full" onclick="calculateMacros()">Calculate Macros</button>
                            <div id="macro-result" class="mt-4"></div>
                        </div>
                    </div>
                    
                    <!-- Body Composition Calculator -->
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">üìè Body Composition Analysis</h2>
                        </div>
                        <div class="card-content">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="bc-weight" class="form-label">Current Weight (kg)</label>
                                    <input type="number" class="form-control" id="bc-weight" placeholder="70" step="0.1" min="1">
                                </div>
                                <div class="form-group">
                                    <label for="bc-height" class="form-label">Height (cm)</label>
                                    <input type="number" class="form-control" id="bc-height" placeholder="175" step="0.1" min="1">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="bc-body-fat" class="form-label">Body Fat % (optional)</label>
                                    <input type="number" class="form-control" id="bc-body-fat" placeholder="15" step="0.1" min="5" max="50">
                                </div>
                                <div class="form-group">
                                    <label for="bc-age" class="form-label">Age (years)</label>
                                    <input type="number" class="form-control" id="bc-age" placeholder="30" min="10" max="100">
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="bc-gender" class="form-label">Biological Sex</label>
                                <select class="form-control" id="bc-gender">
                                    <option value="male">Male</option>
                                    <option value="female">Female</option>
                                </select>
                            </div>
                            <button class="btn btn-primary w-full" onclick="calculateBodyComposition()">Analyze Body Composition</button>
                            <div id="body-composition-result" class="mt-4"></div>
                        </div>
                    </div>
                    
                    <!-- Hydration Calculator -->
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">üíß Hydration Calculator</h2>
                        </div>
                        <div class="card-content">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="hydra-weight" class="form-label">Weight (kg)</label>
                                    <input type="number" class="form-control" id="hydra-weight" placeholder="70" step="0.1" min="1">
                                </div>
                                <div class="form-group">
                                    <label for="exercise-duration" class="form-label">Exercise Duration (minutes)</label>
                                    <input type="number" class="form-control" id="exercise-duration" placeholder="60" min="0" max="480">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="climate" class="form-label">Climate</label>
                                    <select class="form-control" id="climate">
                                        <option value="moderate">Moderate (15-25¬∞C)</option>
                                        <option value="hot">Hot/Humid (>25¬∞C)</option>
                                        <option value="cold">Cold/Dry (<15¬∞C)</option>
                                        <option value="extreme">Extreme Heat (>35¬∞C)</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="sweat-rate" class="form-label">Sweat Rate</label>
                                    <select class="form-control" id="sweat-rate">
                                        <option value="low">Low Sweater</option>
                                        <option value="moderate">Moderate Sweater</option>
                                        <option value="high">Heavy Sweater</option>
                                    </select>
                                </div>
                            </div>
                            <button class="btn btn-primary w-full" onclick="calculateHydration()">Calculate Water Needs</button>
                            <div id="hydration-result" class="mt-4"></div>
                        </div>
                    </div>
                    
                    <!-- Ideal Weight Calculator -->
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">üéØ Ideal Weight Calculator</h2>
                        </div>
                        <div class="card-content">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="iw-height" class="form-label">Height (cm)</label>
                                    <input type="number" class="form-control" id="iw-height" placeholder="175" step="0.1" min="1">
                                </div>
                                <div class="form-group">
                                    <label for="iw-gender" class="form-label">Biological Sex</label>
                                    <select class="form-control" id="iw-gender">
                                        <option value="male">Male</option>
                                        <option value="female">Female</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="iw-frame" class="form-label">Body Frame</label>
                                <select class="form-control" id="iw-frame">
                                    <option value="small">Small Frame</option>
                                    <option value="medium">Medium Frame</option>
                                    <option value="large">Large Frame</option>
                                </select>
                            </div>
                            <button class="btn btn-primary w-full" onclick="calculateIdealWeight()">Calculate Ideal Weight Range</button>
                            <div id="ideal-weight-result" class="mt-4"></div>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- Food Tracker Section -->
            <section id="food-tracker" class="section" role="tabpanel" aria-labelledby="food-tracker-tab">
                <div class="dashboard">
                    <!-- Food Search & Logging -->
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">üîç Food Search & Log</h2>
                            <div class="flex gap-2">
                                <button class="btn btn-outline btn-sm" onclick="openAdvancedSearch()">
                                    <span>‚öôÔ∏è</span> Advanced
                                </button>
                                <button class="btn btn-secondary btn-sm" onclick="openFoodAnalyzer()">
                                    <span>üî¨</span> Analyze
                                </button>
                            </div>
                        </div>
                        <div class="card-content">
                            <!-- Quick Action Buttons -->
                            <div class="grid grid-cols-2 gap-2 mb-4">
                                <button class="btn btn-primary btn-sm" onclick="openBarcodeScanner()">
                                    <span>üì±</span> Scan Barcode
                                </button>
                                <button class="btn btn-success btn-sm" onclick="openPhotoLogger()">
                                    <span>üì∑</span> Photo Log
                                </button>
                                <button class="btn btn-info btn-sm" onclick="startVoiceInput()">
                                    <span>üé§</span> Voice Input
                                </button>
                                <button class="btn btn-warning btn-sm" onclick="openRestaurantDB()">
                                    <span>üçΩÔ∏è</span> Restaurant
                                </button>
                            </div>
                            
                            <!-- Food Search -->
                            <div class="form-group">
                                <label for="food-search" class="form-label">Search Foods</label>
                                <div class="relative">
                                    <input type="text" class="form-control" id="food-search" 
                                           placeholder="Search 10,000+ foods, brands, or recipes..." 
                                           oninput="searchFoods(this.value)" autocomplete="off">
                                    <div id="search-results" class="absolute top-full left-0 right-0 bg-white border border-gray-200 rounded-lg shadow-lg z-10 max-h-60 overflow-y-auto hidden"></div>
                                </div>
                            </div>
                            
                            <!-- Quick Filters -->
                            <div class="flex flex-wrap gap-2 mb-4">
                                <button class="btn btn-outline btn-sm" onclick="filterFoods('recent')">Recent</button>
                                <button class="btn btn-outline btn-sm" onclick="filterFoods('favorites')">Favorites</button>
                                <button class="btn btn-outline btn-sm" onclick="filterFoods('high-protein')">High Protein</button>
                                <button class="btn btn-outline btn-sm" onclick="filterFoods('low-carb')">Low Carb</button>
                                <button class="btn btn-outline btn-sm" onclick="filterFoods('keto-friendly')">Keto</button>
                                <button class="btn btn-outline btn-sm" onclick="filterFoods('vegan')">Vegan</button>
                            </div>
                            
                            <!-- Selected Food Details -->
                            <div id="selected-food-details" class="hidden">
                                <div class="bg-gray-50 p-4 rounded-lg mb-4">
                                    <div class="flex justify-between items-start mb-3">
                                        <div>
                                            <h3 id="selected-food-name" class="font-semibold text-lg">Food Name</h3>
                                            <p id="selected-food-brand" class="text-sm text-gray-600">Brand</p>
                                        </div>
                                        <button class="btn btn-outline btn-sm" onclick="addToFavorites()">
                                            <span id="favorite-icon">‚ô°</span>
                                        </button>
                                    </div>
                                    
                                    <!-- Portion Selection -->
                                    <div class="form-row mb-3">
                                        <div class="form-group">
                                            <label for="portion-amount" class="form-label">Amount</label>
                                            <input type="number" class="form-control" id="portion-amount" value="1" step="0.1" min="0.1" oninput="updateNutritionDisplay()">
                                        </div>
                                        <div class="form-group">
                                            <label for="portion-unit" class="form-label">Unit</label>
                                            <select class="form-control" id="portion-unit" onchange="updateNutritionDisplay()">
                                                <option value="serving">Serving</option>
                                                <option value="cup">Cup</option>
                                                <option value="gram">Gram</option>
                                                <option value="ounce">Ounce</option>
                                                <option value="piece">Piece</option>
                                                <option value="slice">Slice</option>
                                                <option value="tablespoon">Tablespoon</option>
                                                <option value="teaspoon">Teaspoon</option>
                                            </select>
                                        </div>
                                    </div>
                                    
                                    <!-- Meal Type Selection -->
                                    <div class="form-group mb-3">
                                        <label for="meal-type" class="form-label">Meal</label>
                                        <select class="form-control" id="meal-type">
                                            <option value="breakfast">Breakfast</option>
                                            <option value="lunch">Lunch</option>
                                            <option value="dinner">Dinner</option>
                                            <option value="snack">Snack</option>
                                        </select>
                                    </div>
                                    
                                    <!-- Nutrition Preview -->
                                    <div id="nutrition-preview" class="grid grid-cols-4 gap-2 text-center text-sm mb-3">
                                        <div class="bg-white p-2 rounded">
                                            <div class="font-semibold text-lg" id="preview-calories">0</div>
                                            <div class="text-gray-600">Calories</div>
                                        </div>
                                        <div class="bg-white p-2 rounded">
                                            <div class="font-semibold text-lg" id="preview-protein">0g</div>
                                            <div class="text-gray-600">Protein</div>
                                        </div>
                                        <div class="bg-white p-2 rounded">
                                            <div class="font-semibold text-lg" id="preview-carbs">0g</div>
                                            <div class="text-gray-600">Carbs</div>
                                        </div>
                                        <div class="bg-white p-2 rounded">
                                            <div class="font-semibold text-lg" id="preview-fat">0g</div>
                                            <div class="text-gray-600">Fat</div>
                                        </div>
                                    </div>
                                    
                                    <button class="btn btn-primary w-full" onclick="logSelectedFood()">
                                        <span>‚úì</span> Add to Food Log
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Today's Food Log -->
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">üìã Today's Food Log</h2>
                            <div class="flex gap-2">
                                <button class="btn btn-outline btn-sm" onclick="exportFoodLog()">
                                    <span>üìé</span> Export
                                </button>
                                <button class="btn btn-secondary btn-sm" onclick="clearTodayLog()">
                                    <span>üóëÔ∏è</span> Clear
                                </button>
                            </div>
                        </div>
                        <div class="card-content">
                            <div id="todays-food-log">
                                <div class="text-center text-gray-500 py-8">
                                    <div class="text-4xl mb-2">üçΩÔ∏è</div>
                                    <p>No foods logged today</p>
                                    <p class="text-sm">Start by searching for foods above</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Nutrition Summary -->
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">üìà Daily Nutrition Summary</h2>
                            <button class="btn btn-outline btn-sm" onclick="showNutritionBreakdown()">
                                <span>üìÅ</span> Details
                            </button>
                        </div>
                        <div class="card-content">
                            <!-- Macro Progress Bars -->
                            <div class="space-y-4 mb-6">
                                <div>
                                    <div class="flex justify-between text-sm mb-1">
                                        <span class="font-medium">Calories</span>
                                        <span id="calorie-progress-text">0 / 2000</span>
                                    </div>
                                    <div class="progress-bar">
                                        <div class="progress-fill" id="daily-calorie-progress" style="width: 0%"></div>
                                    </div>
                                </div>
                                
                                <div>
                                    <div class="flex justify-between text-sm mb-1">
                                        <span class="font-medium">Protein</span>
                                        <span id="protein-progress-text">0g / 150g</span>
                                    </div>
                                    <div class="progress-bar">
                                        <div class="progress-fill" id="daily-protein-progress" style="width: 0%; background: var(--info)"></div>
                                    </div>
                                </div>
                                
                                <div>
                                    <div class="flex justify-between text-sm mb-1">
                                        <span class="font-medium">Carbs</span>
                                        <span id="carb-progress-text">0g / 200g</span>
                                    </div>
                                    <div class="progress-bar">
                                        <div class="progress-fill" id="daily-carb-progress" style="width: 0%; background: var(--warning)"></div>
                                    </div>
                                </div>
                                
                                <div>
                                    <div class="flex justify-between text-sm mb-1">
                                        <span class="font-medium">Fat</span>
                                        <span id="fat-progress-text">0g / 67g</span>
                                    </div>
                                    <div class="progress-bar">
                                        <div class="progress-fill" id="daily-fat-progress" style="width: 0%; background: var(--secondary-500)"></div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Quick Stats Grid -->
                            <div class="grid grid-cols-2 gap-4">
                                <div class="stat-card" style="background: var(--success);">
                                    <span class="stat-number" id="fiber-total">0g</span>
                                    <span class="stat-label">Fiber</span>
                                    <span class="stat-subtitle">Goal: 25g</span>
                                </div>
                                <div class="stat-card" style="background: var(--info);">
                                    <span class="stat-number" id="sugar-total">0g</span>
                                    <span class="stat-label">Sugar</span>
                                    <span class="stat-subtitle">Limit: 50g</span>
                                </div>
                                <div class="stat-card" style="background: var(--warning);">
                                    <span class="stat-number" id="sodium-total">0mg</span>
                                    <span class="stat-label">Sodium</span>
                                    <span class="stat-subtitle">Limit: 2300mg</span>
                                </div>
                                <div class="stat-card" style="background: var(--secondary-500);">
                                    <span class="stat-number" id="cholesterol-total">0mg</span>
                                    <span class="stat-label">Cholesterol</span>
                                    <span class="stat-subtitle">Limit: 300mg</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Micronutrient Tracker -->
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">üî¨ Micronutrient Tracker</h2>
                            <button class="btn btn-outline btn-sm" onclick="showDeficiencyAnalysis()">
                                <span>‚ö†Ô∏è</span> Analysis
                            </button>
                        </div>
                        <div class="card-content">
                            <div class="grid grid-cols-2 gap-4">
                                <!-- Vitamins -->
                                <div>
                                    <h4 class="font-semibold mb-3">Vitamins</h4>
                                    <div class="space-y-2">
                                        <div class="flex justify-between items-center text-sm">
                                            <span>Vitamin C</span>
                                            <div class="flex items-center gap-2">
                                                <div class="w-16 h-2 bg-gray-200 rounded-full">
                                                    <div class="h-full bg-orange-400 rounded-full" id="vitamin-c-bar" style="width: 0%"></div>
                                                </div>
                                                <span id="vitamin-c-amount" class="w-12 text-xs">0%</span>
                                            </div>
                                        </div>
                                        <div class="flex justify-between items-center text-sm">
                                            <span>Vitamin D</span>
                                            <div class="flex items-center gap-2">
                                                <div class="w-16 h-2 bg-gray-200 rounded-full">
                                                    <div class="h-full bg-yellow-400 rounded-full" id="vitamin-d-bar" style="width: 0%"></div>
                                                </div>
                                                <span id="vitamin-d-amount" class="w-12 text-xs">0%</span>
                                            </div>
                                        </div>
                                        <div class="flex justify-between items-center text-sm">
                                            <span>Vitamin A</span>
                                            <div class="flex items-center gap-2">
                                                <div class="w-16 h-2 bg-gray-200 rounded-full">
                                                    <div class="h-full bg-green-400 rounded-full" id="vitamin-a-bar" style="width: 0%"></div>
                                                </div>
                                                <span id="vitamin-a-amount" class="w-12 text-xs">0%</span>
                                            </div>
                                        </div>
                                        <div class="flex justify-between items-center text-sm">
                                            <span>B-12</span>
                                            <div class="flex items-center gap-2">
                                                <div class="w-16 h-2 bg-gray-200 rounded-full">
                                                    <div class="h-full bg-blue-400 rounded-full" id="vitamin-b12-bar" style="width: 0%"></div>
                                                </div>
                                                <span id="vitamin-b12-amount" class="w-12 text-xs">0%</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Minerals -->
                                <div>
                                    <h4 class="font-semibold mb-3">Minerals</h4>
                                    <div class="space-y-2">
                                        <div class="flex justify-between items-center text-sm">
                                            <span>Iron</span>
                                            <div class="flex items-center gap-2">
                                                <div class="w-16 h-2 bg-gray-200 rounded-full">
                                                    <div class="h-full bg-red-400 rounded-full" id="iron-bar" style="width: 0%"></div>
                                                </div>
                                                <span id="iron-amount" class="w-12 text-xs">0%</span>
                                            </div>
                                        </div>
                                        <div class="flex justify-between items-center text-sm">
                                            <span>Calcium</span>
                                            <div class="flex items-center gap-2">
                                                <div class="w-16 h-2 bg-gray-200 rounded-full">
                                                    <div class="h-full bg-indigo-400 rounded-full" id="calcium-bar" style="width: 0%"></div>
                                                </div>
                                                <span id="calcium-amount" class="w-12 text-xs">0%</span>
                                            </div>
                                        </div>
                                        <div class="flex justify-between items-center text-sm">
                                            <span>Magnesium</span>
                                            <div class="flex items-center gap-2">
                                                <div class="w-16 h-2 bg-gray-200 rounded-full">
                                                    <div class="h-full bg-purple-400 rounded-full" id="magnesium-bar" style="width: 0%"></div>
                                                </div>
                                                <span id="magnesium-amount" class="w-12 text-xs">0%</span>
                                            </div>
                                        </div>
                                        <div class="flex justify-between items-center text-sm">
                                            <span>Potassium</span>
                                            <div class="flex items-center gap-2">
                                                <div class="w-16 h-2 bg-gray-200 rounded-full">
                                                    <div class="h-full bg-pink-400 rounded-full" id="potassium-bar" style="width: 0%"></div>
                                                </div>
                                                <span id="potassium-amount" class="w-12 text-xs">0%</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            
            <section id="meal-planner" class="section" role="tabpanel" aria-labelledby="meal-planner-tab">
                <!-- Meal Planning Overview -->
                <div class="card mb-6">
                    <div class="card-header">
                        <h1 class="card-title">üìÖ AI-Powered Meal Planner</h1>
                        <button class="btn btn-primary" onclick="generateMealPlan()">üé≤ Generate New Plan</button>
                    </div>
                    <div class="card-content">
                        <div class="grid grid-4">
                            <div class="metric-card">
                                <div class="metric-value" id="weekly-calories">14,000</div>
                                <div class="metric-label">Weekly Calories</div>
                            </div>
                            <div class="metric-card">
                                <div class="metric-value" id="planned-meals">21</div>
                                <div class="metric-label">Planned Meals</div>
                            </div>
                            <div class="metric-card">
                                <div class="metric-value" id="grocery-cost">$85</div>
                                <div class="metric-label">Est. Cost</div>
                            </div>
                            <div class="metric-card">
                                <div class="metric-value" id="prep-time">4.5h</div>
                                <div class="metric-label">Weekly Prep</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Meal Planning Preferences -->
                <div class="card mb-6">
                    <div class="card-header">
                        <h2 class="card-title">üéØ Planning Preferences</h2>
                        <button class="btn btn-outline" onclick="showMealPlanSettings()">‚öôÔ∏è Settings</button>
                    </div>
                    <div class="card-content">
                        <div class="grid grid-3">
                            <div class="form-group">
                                <label class="form-label">Diet Type</label>
                                <select class="form-input" id="diet-type" onchange="updateMealPreferences()">
                                    <option value="balanced">Balanced</option>
                                    <option value="keto">Ketogenic</option>
                                    <option value="paleo">Paleo</option>
                                    <option value="vegan">Vegan</option>
                                    <option value="vegetarian">Vegetarian</option>
                                    <option value="mediterranean">Mediterranean</option>
                                    <option value="low-carb">Low Carb</option>
                                    <option value="high-protein">High Protein</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Budget Range</label>
                                <select class="form-input" id="budget-range" onchange="updateMealPreferences()">
                                    <option value="budget">Budget ($40-60/week)</option>
                                    <option value="moderate" selected>Moderate ($60-100/week)</option>
                                    <option value="premium">Premium ($100-150/week)</option>
                                    <option value="luxury">Luxury ($150+/week)</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Cooking Skill</label>
                                <select class="form-input" id="cooking-skill" onchange="updateMealPreferences()">
                                    <option value="beginner">Beginner (15-20 min meals)</option>
                                    <option value="intermediate" selected>Intermediate (30-45 min)</option>
                                    <option value="advanced">Advanced (45+ min)</option>
                                    <option value="chef">Chef Level (Any complexity)</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-group mt-4">
                            <label class="form-label">Allergies & Restrictions</label>
                            <div class="tag-container">
                                <span class="tag tag-removable" onclick="removeAllergy('gluten')">üö´ Gluten <span class="tag-remove">√ó</span></span>
                                <span class="tag tag-removable" onclick="removeAllergy('dairy')">üö´ Dairy <span class="tag-remove">√ó</span></span>
                                <button class="btn btn-sm btn-outline" onclick="showAllergySelector()">+ Add Restriction</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Weekly Meal Plan -->
                <div class="card mb-6">
                    <div class="card-header">
                        <h2 class="card-title">üìÖ This Week's Plan</h2>
                        <div class="button-group">
                            <button class="btn btn-outline" onclick="prevWeek()">‚Üê Previous</button>
                            <button class="btn btn-outline" onclick="nextWeek()">Next ‚Üí</button>
                            <button class="btn btn-primary" onclick="exportMealPlan()">üìÑ Export</button>
                        </div>
                    </div>
                    <div class="card-content">
                        <div id="weekly-meal-plan" class="meal-plan-grid">
                            <!-- Dynamic weekly plan will be inserted here -->
                        </div>
                    </div>
                </div>

                <!-- Recipe Suggestions -->
                <div class="card mb-6">
                    <div class="card-header">
                        <h2 class="card-title">üç≥ AI Recipe Suggestions</h2>
                        <button class="btn btn-outline" onclick="refreshRecipes()">üîÑ Refresh</button>
                    </div>
                    <div class="card-content">
                        <div id="recipe-suggestions" class="recipe-grid">
                            <!-- AI-generated recipe suggestions -->
                        </div>
                    </div>
                </div>

                <!-- Grocery List -->
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">üõí Smart Grocery List</h2>
                        <div class="button-group">
                            <button class="btn btn-outline" onclick="optimizeGroceryList()">‚ú® Optimize</button>
                            <button class="btn btn-primary" onclick="exportGroceryList()">üì± Send to Phone</button>
                        </div>
                    </div>
                    <div class="card-content">
                        <div class="grocery-categories">
                            <div id="grocery-list">
                                <!-- Smart categorized grocery list -->
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            
            <section id="progress" class="section" role="tabpanel" aria-labelledby="progress-tab">
                <!-- Analytics Overview -->
                <div class="card mb-6">
                    <div class="card-header">
                        <h1 class="card-title">üìä Analytics Dashboard</h1>
                        <div class="button-group">
                            <button class="btn btn-outline" onclick="changeTimeframe('week')" id="btn-week">7 Days</button>
                            <button class="btn btn-outline active" onclick="changeTimeframe('month')" id="btn-month">30 Days</button>
                            <button class="btn btn-outline" onclick="changeTimeframe('year')" id="btn-year">1 Year</button>
                            <button class="btn btn-primary" onclick="generateReport()">üìÑ Report</button>
                        </div>
                    </div>
                    <div class="card-content">
                        <div class="grid grid-4">
                            <div class="analytics-metric">
                                <div class="metric-icon">‚öñÔ∏è</div>
                                <div class="metric-content">
                                    <div class="metric-value" id="weight-change">-3.2 lbs</div>
                                    <div class="metric-label">Weight Change</div>
                                    <div class="metric-trend positive">‚ÜóÔ∏è +12% this month</div>
                                </div>
                            </div>
                            <div class="analytics-metric">
                                <div class="metric-icon">üî•</div>
                                <div class="metric-content">
                                    <div class="metric-value" id="avg-calories">1,847</div>
                                    <div class="metric-label">Avg Daily Calories</div>
                                    <div class="metric-trend neutral">‚Üí Target: 2,000</div>
                                </div>
                            </div>
                            <div class="analytics-metric">
                                <div class="metric-icon">üí™</div>
                                <div class="metric-content">
                                    <div class="metric-value" id="avg-protein">142g</div>
                                    <div class="metric-label">Avg Daily Protein</div>
                                    <div class="metric-trend positive">‚ÜóÔ∏è +8g vs target</div>
                                </div>
                            </div>
                            <div class="analytics-metric">
                                <div class="metric-icon">üéØ</div>
                                <div class="metric-content">
                                    <div class="metric-value" id="goal-streak">23</div>
                                    <div class="metric-label">Goal Streak</div>
                                    <div class="metric-trend positive">‚ÜóÔ∏è Personal best!</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Interactive Charts -->
                <div class="grid grid-2 mb-6">
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">üìà Weight & Body Composition</h2>
                            <button class="btn btn-outline btn-sm" onclick="addBodyMeasurement()">+ Add Data</button>
                        </div>
                        <div class="card-content">
                            <div class="chart-container">
                                <canvas id="weight-chart" width="400" height="300"></canvas>
                            </div>
                            <div class="chart-stats">
                                <div class="stat">
                                    <span class="stat-label">Start Weight:</span>
                                    <span class="stat-value">175.8 lbs</span>
                                </div>
                                <div class="stat">
                                    <span class="stat-label">Current:</span>
                                    <span class="stat-value">172.6 lbs</span>
                                </div>
                                <div class="stat">
                                    <span class="stat-label">Goal:</span>
                                    <span class="stat-value">165.0 lbs</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">üî• Calorie Intake Trends</h2>
                            <select class="form-control" onchange="updateCalorieChart(this.value)">
                                <option value="daily">Daily View</option>
                                <option value="weekly">Weekly Average</option>
                                <option value="monthly">Monthly Trends</option>
                            </select>
                        </div>
                        <div class="card-content">
                            <div class="chart-container">
                                <canvas id="calorie-chart" width="400" height="300"></canvas>
                            </div>
                            <div class="calorie-breakdown">
                                <div class="breakdown-item">
                                    <div class="breakdown-color" style="background: #10B981;"></div>
                                    <span>Under Target (22%)</span>
                                </div>
                                <div class="breakdown-item">
                                    <div class="breakdown-color" style="background: #F59E0B;"></div>
                                    <span>On Target (51%)</span>
                                </div>
                                <div class="breakdown-item">
                                    <div class="breakdown-color" style="background: #EF4444;"></div>
                                    <span>Over Target (27%)</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Nutrition Analysis -->
                <div class="card mb-6">
                    <div class="card-header">
                        <h2 class="card-title">ü•ó Nutritional Analysis</h2>
                        <div class="button-group">
                            <button class="btn btn-outline btn-sm active" onclick="showNutritionView('macros')">Macros</button>
                            <button class="btn btn-outline btn-sm" onclick="showNutritionView('micros')">Micros</button>
                            <button class="btn btn-outline btn-sm" onclick="showNutritionView('timing')">Meal Timing</button>
                        </div>
                    </div>
                    <div class="card-content">
                        <div id="nutrition-macros" class="nutrition-view">
                            <div class="grid grid-3">
                                <div class="macro-analysis">
                                    <h3 class="macro-title">Carbohydrates</h3>
                                    <div class="macro-chart">
                                        <div class="macro-ring" style="--progress: 78%;">
                                            <div class="macro-value">156g</div>
                                            <div class="macro-target">/ 200g</div>
                                        </div>
                                    </div>
                                    <div class="macro-stats">
                                        <div>Avg: 168g/day</div>
                                        <div>Trend: ‚ÜòÔ∏è -5%</div>
                                        <div>Quality Score: B+</div>
                                    </div>
                                </div>
                                <div class="macro-analysis">
                                    <h3 class="macro-title">Protein</h3>
                                    <div class="macro-chart">
                                        <div class="macro-ring" style="--progress: 95%;">
                                            <div class="macro-value">142g</div>
                                            <div class="macro-target">/ 150g</div>
                                        </div>
                                    </div>
                                    <div class="macro-stats">
                                        <div>Avg: 139g/day</div>
                                        <div>Trend: ‚ÜóÔ∏è +8%</div>
                                        <div>Quality Score: A-</div>
                                    </div>
                                </div>
                                <div class="macro-analysis">
                                    <h3 class="macro-title">Fat</h3>
                                    <div class="macro-chart">
                                        <div class="macro-ring" style="--progress: 67%;">
                                            <div class="macro-value">53g</div>
                                            <div class="macro-target">/ 80g</div>
                                        </div>
                                    </div>
                                    <div class="macro-stats">
                                        <div>Avg: 61g/day</div>
                                        <div>Trend: ‚Üí 0%</div>
                                        <div>Quality Score: A</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div id="nutrition-micros" class="nutrition-view hidden">
                            <div class="micronutrient-grid">
                                <div class="micro-item">
                                    <div class="micro-header">
                                        <span class="micro-name">Vitamin D</span>
                                        <span class="micro-status excellent">Excellent</span>
                                    </div>
                                    <div class="micro-bar">
                                        <div class="micro-progress" style="width: 120%;"></div>
                                    </div>
                                    <div class="micro-details">24 ¬µg / 20 ¬µg daily</div>
                                </div>
                                <div class="micro-item">
                                    <div class="micro-header">
                                        <span class="micro-name">Iron</span>
                                        <span class="micro-status good">Good</span>
                                    </div>
                                    <div class="micro-bar">
                                        <div class="micro-progress" style="width: 85%;"></div>
                                    </div>
                                    <div class="micro-details">15.3 mg / 18 mg daily</div>
                                </div>
                                <div class="micro-item">
                                    <div class="micro-header">
                                        <span class="micro-name">Vitamin C</span>
                                        <span class="micro-status excellent">Excellent</span>
                                    </div>
                                    <div class="micro-bar">
                                        <div class="micro-progress" style="width: 134%;"></div>
                                    </div>
                                    <div class="micro-details">121 mg / 90 mg daily</div>
                                </div>
                                <div class="micro-item">
                                    <div class="micro-header">
                                        <span class="micro-name">Calcium</span>
                                        <span class="micro-status warning">Low</span>
                                    </div>
                                    <div class="micro-bar">
                                        <div class="micro-progress" style="width: 62%;"></div>
                                    </div>
                                    <div class="micro-details">744 mg / 1200 mg daily</div>
                                </div>
                                <div class="micro-item">
                                    <div class="micro-header">
                                        <span class="micro-name">Omega-3</span>
                                        <span class="micro-status good">Good</span>
                                    </div>
                                    <div class="micro-bar">
                                        <div class="micro-progress" style="width: 78%;"></div>
                                    </div>
                                    <div class="micro-details">1.4 g / 1.8 g daily</div>
                                </div>
                                <div class="micro-item">
                                    <div class="micro-header">
                                        <span class="micro-name">Fiber</span>
                                        <span class="micro-status excellent">Excellent</span>
                                    </div>
                                    <div class="micro-bar">
                                        <div class="micro-progress" style="width: 108%;"></div>
                                    </div>
                                    <div class="micro-details">27 g / 25 g daily</div>
                                </div>
                            </div>
                        </div>

                        <div id="nutrition-timing" class="nutrition-view hidden">
                            <div class="meal-timing-analysis">
                                <h3>Optimal Meal Timing Analysis</h3>
                                <div class="timing-chart">
                                    <div class="timeline">
                                        <div class="time-marker" style="left: 8%;">
                                            <div class="time-label">6 AM</div>
                                            <div class="meal-marker breakfast">
                                                <div class="meal-info">Breakfast<br>520 cal</div>
                                            </div>
                                        </div>
                                        <div class="time-marker" style="left: 50%;">
                                            <div class="time-label">12 PM</div>
                                            <div class="meal-marker lunch">
                                                <div class="meal-info">Lunch<br>680 cal</div>
                                            </div>
                                        </div>
                                        <div class="time-marker" style="left: 75%;">
                                            <div class="time-label">6 PM</div>
                                            <div class="meal-marker dinner">
                                                <div class="meal-info">Dinner<br>740 cal</div>
                                            </div>
                                        </div>
                                        <div class="time-marker" style="left: 92%;">
                                            <div class="time-label">9 PM</div>
                                            <div class="meal-marker snack">
                                                <div class="meal-info">Snack<br>180 cal</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="timing-insights">
                                    <div class="insight positive">‚úÖ Good breakfast timing for metabolism</div>
                                    <div class="insight positive">‚úÖ Ideal lunch-dinner gap (6 hours)</div>
                                    <div class="insight warning">‚ö†Ô∏è Late evening snack may affect sleep</div>
                                    <div class="insight positive">‚úÖ Consistent meal timing supports circadian rhythm</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Habit Tracking -->
                <div class="card mb-6">
                    <div class="card-header">
                        <h2 class="card-title">üéØ Habit & Goal Tracking</h2>
                        <button class="btn btn-primary" onclick="addNewHabit()">+ Add Habit</button>
                    </div>
                    <div class="card-content">
                        <div class="habits-grid">
                            <div class="habit-card">
                                <div class="habit-header">
                                    <h3 class="habit-name">üíß Daily Hydration</h3>
                                    <div class="habit-streak">23 day streak</div>
                                </div>
                                <div class="habit-progress">
                                    <div class="progress-bar">
                                        <div class="progress-fill" style="width: 87%;"></div>
                                    </div>
                                    <div class="progress-text">2.6L / 3.0L today</div>
                                </div>
                                <div class="habit-actions">
                                    <button class="btn btn-sm btn-primary" onclick="logWater()">+ 250ml</button>
                                    <button class="btn btn-sm btn-outline" onclick="viewHabitDetails('hydration')">Details</button>
                                </div>
                            </div>

                            <div class="habit-card">
                                <div class="habit-header">
                                    <h3 class="habit-name">üèÉ Daily Steps</h3>
                                    <div class="habit-streak">18 day streak</div>
                                </div>
                                <div class="habit-progress">
                                    <div class="progress-bar">
                                        <div class="progress-fill" style="width: 76%;"></div>
                                    </div>
                                    <div class="progress-text">7,634 / 10,000 steps</div>
                                </div>
                                <div class="habit-actions">
                                    <button class="btn btn-sm btn-success">‚úì Auto-tracked</button>
                                    <button class="btn btn-sm btn-outline" onclick="viewHabitDetails('steps')">Details</button>
                                </div>
                            </div>

                            <div class="habit-card">
                                <div class="habit-header">
                                    <h3 class="habit-name">ü•¨ Veggie Servings</h3>
                                    <div class="habit-streak">12 day streak</div>
                                </div>
                                <div class="habit-progress">
                                    <div class="progress-bar">
                                        <div class="progress-fill" style="width: 100%;"></div>
                                    </div>
                                    <div class="progress-text">5 / 5 servings today</div>
                                </div>
                                <div class="habit-actions">
                                    <button class="btn btn-sm btn-success">‚úì Complete</button>
                                    <button class="btn btn-sm btn-outline" onclick="viewHabitDetails('veggies')">Details</button>
                                </div>
                            </div>

                            <div class="habit-card">
                                <div class="habit-header">
                                    <h3 class="habit-name">üò¥ Sleep Quality</h3>
                                    <div class="habit-streak">8.2 avg rating</div>
                                </div>
                                <div class="habit-progress">
                                    <div class="sleep-rating">
                                        <div class="stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÜ</div>
                                        <div class="sleep-duration">7h 45m last night</div>
                                    </div>
                                </div>
                                <div class="habit-actions">
                                    <button class="btn btn-sm btn-primary" onclick="rateSleep()">Rate Sleep</button>
                                    <button class="btn btn-sm btn-outline" onclick="viewHabitDetails('sleep')">Details</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Insights & Recommendations -->
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">üí° AI Insights & Recommendations</h2>
                        <button class="btn btn-outline" onclick="refreshInsights()">üîÑ Refresh</button>
                    </div>
                    <div class="card-content">
                        <div class="insights-container">
                            <div class="insight-card priority-high">
                                <div class="insight-icon">üö®</div>
                                <div class="insight-content">
                                    <h3 class="insight-title">Low Calcium Intake Detected</h3>
                                    <p class="insight-description">You're averaging only 744mg of calcium daily, well below the 1200mg recommendation. This could impact bone health.</p>
                                    <div class="insight-actions">
                                        <button class="btn btn-sm btn-primary" onclick="suggestCalciumFoods()">Show Calcium-Rich Foods</button>
                                        <button class="btn btn-sm btn-outline" onclick="dismissInsight('calcium')">Dismiss</button>
                                    </div>
                                </div>
                            </div>

                            <div class="insight-card priority-medium">
                                <div class="insight-icon">‚è∞</div>
                                <div class="insight-content">
                                    <h3 class="insight-title">Optimize Meal Timing</h3>
                                    <p class="insight-description">Your late evening snacks might be affecting sleep quality. Consider moving your last meal 2-3 hours earlier.</p>
                                    <div class="insight-actions">
                                        <button class="btn btn-sm btn-primary" onclick="suggestMealTiming()">Optimize Schedule</button>
                                        <button class="btn btn-sm btn-outline" onclick="dismissInsight('timing')">Dismiss</button>
                                    </div>
                                </div>
                            </div>

                            <div class="insight-card priority-low">
                                <div class="insight-icon">üéâ</div>
                                <div class="insight-content">
                                    <h3 class="insight-title">Excellent Protein Consistency!</h3>
                                    <p class="insight-description">You've maintained your protein target for 18 consecutive days. This consistency is excellent for muscle maintenance and satiety.</p>
                                    <div class="insight-actions">
                                        <button class="btn btn-sm btn-success" onclick="shareAchievement('protein')">Share Achievement</button>
                                    </div>
                                </div>
                            </div>

                            <div class="insight-card priority-medium">
                                <div class="insight-icon">ü•§</div>
                                <div class="insight-content">
                                    <h3 class="insight-title">Hydration Pattern Analysis</h3>
                                    <p class="insight-description">Your hydration drops significantly on weekends. Setting weekend reminders could help maintain consistency.</p>
                                    <div class="insight-actions">
                                        <button class="btn btn-sm btn-primary" onclick="setupHydrationReminders()">Set Reminders</button>
                                        <button class="btn btn-sm btn-outline" onclick="dismissInsight('hydration')">Dismiss</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            
            <section id="professional" class="section" role="tabpanel" aria-labelledby="professional-tab">
                <div class="card">
                    <div class="card-header">
                        <h1 class="card-title">üë©‚Äç‚öïÔ∏è Professional Tools</h1>
                    </div>
                    <div class="card-content">
                        <p>Professional nutrition tools coming in Phase 4A...</p>
                    </div>
                </div>
            </section>
        </div>
    </main>
    
    <!-- Modal Container -->
    <div id="modal" class="modal" role="dialog" aria-labelledby="modal-title" aria-hidden="true">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-title" class="modal-title">Modal Title</h3>
                <button class="modal-close" onclick="closeModal()" aria-label="Close modal">
                    <span>‚úï</span>
                </button>
            </div>
            <div class="modal-body" id="modal-body">
                <!-- Dynamic content will be inserted here -->
            </div>
            <div class="modal-footer" id="modal-footer">
                <!-- Dynamic footer content will be inserted here -->
            </div>
        </div>
    </div>
    
    <script>
        // ===== APPLICATION STATE & CONFIGURATION =====
        
        // Application configuration
        const CONFIG = {
            version: '1.0.0',
            appName: 'Ultimate Nutrition Platform',
            defaultTheme: 'light',
            storageKeys: {
                theme: 'unp_theme',
                userProfile: 'unp_user_profile',
                foodLog: 'unp_food_log',
                waterIntake: 'unp_water_intake',
                settings: 'unp_settings'
            },
            goals: {
                defaultCalories: 2000,
                defaultProtein: 150,
                defaultWater: 2.5
            }
        };
        
        // Global application state
        let currentSection = 'dashboard';
        let userProfile = {};
        let foodLog = [];
        let waterIntake = 0;
        let appSettings = {};
        
        // ===== CORE APPLICATION FUNCTIONS =====
        
        /**
         * Initialize the application
         */
        function initializeApp() {
            console.log(`Initializing ${CONFIG.appName} v${CONFIG.version}`);
            
            // Load user data
            loadUserData();
            
            // Load theme
            loadTheme();
            
            // Update dashboard
            updateDashboard();
            
            // Setup event listeners
            setupEventListeners();
            
            // Show default section
            showSection('dashboard');
            
            console.log('Application initialized successfully');
        }
        
        /**
         * Load user data from local storage
         */
        function loadUserData() {
            try {
                // Load user profile
                const savedProfile = localStorage.getItem(CONFIG.storageKeys.userProfile);
                userProfile = savedProfile ? JSON.parse(savedProfile) : {
                    goal: 'weight-loss',
                    calorieGoal: CONFIG.goals.defaultCalories,
                    proteinGoal: CONFIG.goals.defaultProtein,
                    waterGoal: CONFIG.goals.defaultWater,
                    currentWeight: null,
                    targetWeight: null,
                    createdAt: new Date().toISOString()
                };
                
                // Load food log
                const savedFoodLog = localStorage.getItem(CONFIG.storageKeys.foodLog);
                foodLog = savedFoodLog ? JSON.parse(savedFoodLog) : [];
                
                // Load water intake
                const savedWaterIntake = localStorage.getItem(CONFIG.storageKeys.waterIntake);
                waterIntake = savedWaterIntake ? parseFloat(savedWaterIntake) : 0;
                
                // Load settings
                const savedSettings = localStorage.getItem(CONFIG.storageKeys.settings);
                appSettings = savedSettings ? JSON.parse(savedSettings) : {
                    notifications: true,
                    language: 'en',
                    units: 'metric'
                };
                
            } catch (error) {
                console.error('Error loading user data:', error);
                // Reset to defaults if corrupted
                userProfile = { goal: 'weight-loss', calorieGoal: CONFIG.goals.defaultCalories };
                foodLog = [];
                waterIntake = 0;
                appSettings = {};
            }
        }
        
        /**
         * Save user data to local storage
         */
        function saveUserData() {
            try {
                localStorage.setItem(CONFIG.storageKeys.userProfile, JSON.stringify(userProfile));
                localStorage.setItem(CONFIG.storageKeys.foodLog, JSON.stringify(foodLog));
                localStorage.setItem(CONFIG.storageKeys.waterIntake, waterIntake.toString());
                localStorage.setItem(CONFIG.storageKeys.settings, JSON.stringify(appSettings));
            } catch (error) {
                console.error('Error saving user data:', error);
                showAlert('Error saving data. Please try again.', 'error');
            }
        }
        
        /**
         * Load and apply theme
         */
        function loadTheme() {
            const savedTheme = localStorage.getItem(CONFIG.storageKeys.theme) || CONFIG.defaultTheme;
            applyTheme(savedTheme);
        }
        
        /**
         * Apply theme to the application
         */
        function applyTheme(theme) {
            document.documentElement.setAttribute('data-theme', theme);
            localStorage.setItem(CONFIG.storageKeys.theme, theme);
            
            // Update theme toggle button
            const themeToggle = document.getElementById('theme-toggle');
            if (themeToggle) {
                if (theme === 'dark') {
                    themeToggle.innerHTML = '<span>‚òÄÔ∏è</span> Light Mode';
                } else {
                    themeToggle.innerHTML = '<span>üåô</span> Dark Mode';
                }
            }
        }
        
        /**
         * Toggle between light and dark themes
         */
        function toggleTheme() {
            const currentTheme = document.documentElement.getAttribute('data-theme') || 'light';
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            applyTheme(newTheme);
            showAlert(`Switched to ${newTheme} mode`, 'success');
        }
        
        /**
         * Setup global event listeners
         */
        function setupEventListeners() {
            // Close modal when clicking outside
            document.addEventListener('click', function(event) {
                const modal = document.getElementById('modal');
                if (event.target === modal) {
                    closeModal();
                }
            });
            
            // Keyboard shortcuts
            document.addEventListener('keydown', function(event) {
                // ESC to close modal
                if (event.key === 'Escape') {
                    closeModal();
                }
                
                // Alt + number keys for quick navigation
                if (event.altKey && event.key >= '1' && event.key <= '6') {
                    event.preventDefault();
                    const sections = ['dashboard', 'calculators', 'food-tracker', 'meal-planner', 'progress', 'professional'];
                    const sectionIndex = parseInt(event.key) - 1;
                    if (sections[sectionIndex]) {
                        showSection(sections[sectionIndex]);
                    }
                }
            });
            
            // Handle browser back/forward buttons
            window.addEventListener('popstate', function(event) {
                if (event.state && event.state.section) {
                    showSection(event.state.section, false);
                }
            });
        }
        
        // ===== NAVIGATION & UI FUNCTIONS =====
        
        /**
         * Show a specific section and hide others
         */
        function showSection(sectionId, updateHistory = true) {
            // Hide all sections
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Show target section
            const targetSection = document.getElementById(sectionId);
            if (targetSection) {
                targetSection.classList.add('active');
                currentSection = sectionId;
                
                // Update navigation active state
                document.querySelectorAll('.nav-item').forEach(item => {
                    item.classList.remove('active');
                    if (item.getAttribute('data-section') === sectionId) {
                        item.classList.add('active');
                    }
                });
                
                // Update browser history
                if (updateHistory) {
                    history.pushState({ section: sectionId }, '', `#${sectionId}`);
                }
                
                // Load section-specific data
                loadSectionData(sectionId);
            }
        }
        
        /**
         * Load data specific to the current section
         */
        function loadSectionData(sectionId) {
            switch (sectionId) {
                case 'dashboard':
                    updateDashboard();
                    break;
                case 'calculators':
                    // Initialize calculators
                    break;
                case 'food-tracker':
                    // Initialize food tracker
                    break;
                case 'meal-planner':
                    initializeMealPlanner();
                    break;
                case 'progress':
                    initializeAnalytics();
                    break;
                case 'professional':
                    // Initialize professional tools
                    break;
            }
        }
        
        // ===== DASHBOARD FUNCTIONS =====
        
        /**
         * Update the dashboard with current data
         */
        function updateDashboard() {
            updateDailyStats();
            updateProgressBars();
            updateGoalDisplay();
            updateRecentActivity();
            updateDailyTip();
        }
        
        /**
         * Update daily statistics cards
         */
        function updateDailyStats() {
            // Calculate daily totals from food log
            const today = new Date().toISOString().split('T')[0];
            const todaysFoods = foodLog.filter(entry => entry.date === today);
            
            const totals = todaysFoods.reduce((acc, entry) => {
                acc.calories += entry.calories || 0;
                acc.protein += entry.protein || 0;
                return acc;
            }, { calories: 0, protein: 0 });
            
            // Update display
            document.getElementById('daily-calories').textContent = Math.round(totals.calories);
            document.getElementById('daily-protein').textContent = totals.protein.toFixed(1) + 'g';
            document.getElementById('daily-water').textContent = waterIntake.toFixed(1) + 'L';
            
            // Update goals display
            document.getElementById('calorie-goal').textContent = `Goal: ${userProfile.calorieGoal}`;
            document.getElementById('protein-goal').textContent = `Goal: ${userProfile.proteinGoal}g`;
            
            // Calculate streak (placeholder)
            const streakDays = calculateLoggingStreak();
            document.getElementById('streak-days').textContent = streakDays;
        }
        
        /**
         * Update progress bars
         */
        function updateProgressBars() {
            const today = new Date().toISOString().split('T')[0];
            const todaysFoods = foodLog.filter(entry => entry.date === today);
            const totalCalories = todaysFoods.reduce((sum, entry) => sum + (entry.calories || 0), 0);
            
            const calorieProgress = Math.min((totalCalories / userProfile.calorieGoal) * 100, 100);
            document.getElementById('calorie-progress').style.width = calorieProgress + '%';
            
            // Update progress text
            document.getElementById('calories-consumed').textContent = `${Math.round(totalCalories)} consumed`;
            document.getElementById('calories-remaining').textContent = `${Math.max(0, userProfile.calorieGoal - Math.round(totalCalories))} remaining`;
        }
        
        /**
         * Update goal display based on selected goal
         */
        function updateGoalDisplay() {
            const goalSelect = document.getElementById('user-goal');
            if (goalSelect && userProfile.goal) {
                goalSelect.value = userProfile.goal;
            }
        }
        
        /**
         * Update recent activity feed
         */
        function updateRecentActivity() {
            const activityDiv = document.getElementById('recent-activity');
            if (!activityDiv) return;
            
            if (foodLog.length === 0) {
                activityDiv.innerHTML = '<p class="text-center text-gray-500">Start logging your meals to see your activity here!</p>';
                return;
            }
            
            // Show last 3 food entries
            const recentEntries = foodLog.slice(-3).reverse();
            let activityHTML = '';
            
            recentEntries.forEach(entry => {
                const timeAgo = getTimeAgo(entry.timestamp || entry.date);
                activityHTML += `
                    <div class="flex items-center justify-between py-2 border-b border-gray-100">
                        <div class="flex items-center gap-3">
                            <span class="text-lg">üçΩÔ∏è</span>
                            <div>
                                <div class="font-medium">${entry.name}</div>
                                <div class="text-sm text-gray-500">${entry.calories} cal ‚Ä¢ ${timeAgo}</div>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            activityDiv.innerHTML = activityHTML;
        }
        
        /**
         * Update daily tip
         */
        function updateDailyTip() {
            const tips = [
                "Aim to include a source of protein with every meal to help maintain stable blood sugar levels.",
                "Drink water before meals to help with portion control and digestion.",
                "Choose whole grains over refined grains for better nutrient density and satiety.",
                "Add colorful vegetables to every meal to increase your micronutrient intake.",
                "Plan your meals ahead of time to make healthier choices throughout the week.",
                "Listen to your hunger and fullness cues to maintain a healthy relationship with food.",
                "Include healthy fats like avocados, nuts, and olive oil to support nutrient absorption.",
                "Try to eat meals at consistent times to help regulate your metabolism."
            ];
            
            const today = new Date().getDate();
            const tipIndex = today % tips.length;
            document.getElementById('daily-tip').textContent = tips[tipIndex];
        }
        
        // ===== UTILITY FUNCTIONS =====
        
        /**
         * Calculate logging streak
         */
        function calculateLoggingStreak() {
            if (foodLog.length === 0) return 0;
            
            // Simple implementation - count consecutive days with entries
            const today = new Date();
            let streak = 0;
            
            for (let i = 0; i < 30; i++) {
                const checkDate = new Date(today);
                checkDate.setDate(today.getDate() - i);
                const dateStr = checkDate.toISOString().split('T')[0];
                
                const hasEntry = foodLog.some(entry => entry.date === dateStr);
                if (hasEntry) {
                    streak++;
                } else {
                    break;
                }
            }
            
            return streak;
        }
        
        /**
         * Get time ago string
         */
        function getTimeAgo(dateString) {
            const date = new Date(dateString);
            const now = new Date();
            const diffMs = now - date;
            const diffMins = Math.floor(diffMs / 60000);
            const diffHours = Math.floor(diffMins / 60);
            const diffDays = Math.floor(diffHours / 24);
            
            if (diffDays > 0) return `${diffDays} day${diffDays > 1 ? 's' : ''} ago`;
            if (diffHours > 0) return `${diffHours} hour${diffHours > 1 ? 's' : ''} ago`;
            if (diffMins > 0) return `${diffMins} minute${diffMins > 1 ? 's' : ''} ago`;
            return 'Just now';
        }
        
        /**
         * Update user goal and related metrics
         */
        function updateGoalMetrics() {
            const goalSelect = document.getElementById('user-goal');
            if (goalSelect) {
                userProfile.goal = goalSelect.value;
                saveUserData();
                showAlert('Goal updated successfully!', 'success');
                
                // Update calorie goals based on goal type
                updateCalorieGoalsForGoal(userProfile.goal);
            }
        }
        
        /**
         * Update calorie goals based on selected goal
         */
        function updateCalorieGoalsForGoal(goal) {
            const goalCalories = {
                'weight-loss': userProfile.tdee ? userProfile.tdee - 500 : 1800,
                'muscle-gain': userProfile.tdee ? userProfile.tdee + 300 : 2300,
                'maintenance': userProfile.tdee || 2000,
                'athletic-performance': userProfile.tdee ? userProfile.tdee + 200 : 2400,
                'health-condition': userProfile.tdee || 2000
            };
            
            userProfile.calorieGoal = goalCalories[goal] || 2000;
            saveUserData();
            updateDashboard();
        }
        
        /**
         * Log water intake
         */
        function logWater() {
            waterIntake += 0.25; // Add 250ml
            saveUserData();
            updateDashboard();
            showAlert('250ml water logged!', 'success');
        }
        
        /**
         * Refresh dashboard data
         */
        function refreshDashboard() {
            updateDashboard();
            showAlert('Dashboard refreshed!', 'success');
        }
        
        // ===== MODAL FUNCTIONS =====
        
        /**
         * Show modal with content
         */
        function showModal(title, content, footer = '') {
            const modal = document.getElementById('modal');
            const modalTitle = document.getElementById('modal-title');
            const modalBody = document.getElementById('modal-body');
            const modalFooter = document.getElementById('modal-footer');
            
            modalTitle.textContent = title;
            modalBody.innerHTML = content;
            modalFooter.innerHTML = footer;
            
            modal.classList.add('active');
            modal.setAttribute('aria-hidden', 'false');
            
            // Focus trap
            const focusableElements = modal.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');
            if (focusableElements.length > 0) {
                focusableElements[0].focus();
            }
        }
        
        /**
         * Close modal
         */
        function closeModal() {
            const modal = document.getElementById('modal');
            modal.classList.remove('active');
            modal.setAttribute('aria-hidden', 'true');
        }
        
        // ===== ALERT SYSTEM =====
        
        /**
         * Show alert message
         */
        function showAlert(message, type = 'info', duration = 3000) {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type}`;
            alertDiv.style.cssText = `
                position: fixed;
                top: 100px;
                right: 20px;
                z-index: 3000;
                max-width: 400px;
                animation: slideIn 0.3s ease-out;
            `;
            
            const icons = {
                success: '‚úÖ',
                warning: '‚ö†Ô∏è',
                error: '‚ùå',
                info: '‚ÑπÔ∏è'
            };
            
            alertDiv.innerHTML = `
                <div class="flex items-start gap-3">
                    <span>${icons[type] || icons.info}</span>
                    <div>${message}</div>
                    <button onclick="this.parentElement.parentElement.remove()" class="ml-auto text-lg leading-none">&times;</button>
                </div>
            `;
            
            document.body.appendChild(alertDiv);
            
            // Auto remove after duration
            setTimeout(() => {
                if (alertDiv.parentNode) {
                    alertDiv.style.animation = 'slideOut 0.3s ease-in';
                    setTimeout(() => alertDiv.remove(), 300);
                }
            }, duration);
        }
        
        // ===== CALCULATOR FUNCTIONS =====
        
        /**
         * BMI Calculator with multiple classification systems
         */
        function calculateBMI() {
            const weight = parseFloat(document.getElementById('bmi-weight').value);
            const height = parseFloat(document.getElementById('bmi-height').value);
            const units = document.getElementById('bmi-units').value;
            
            if (!weight || !height) {
                showAlert('Please enter valid weight and height values.', 'warning');
                return;
            }
            
            // Convert to metric if needed
            let weightKg = weight;
            let heightM = height;
            
            if (units === 'imperial') {
                weightKg = weight * 0.453592; // lbs to kg
                heightM = height * 2.54; // inches to cm
            }
            
            heightM = heightM / 100; // cm to meters
            const bmi = weightKg / (heightM * heightM);
            
            // WHO Classification
            let whoCategory = '';
            let whoColor = '';
            if (bmi < 18.5) {
                whoCategory = 'Underweight';
                whoColor = 'var(--info)';
            } else if (bmi < 25) {
                whoCategory = 'Normal weight';
                whoColor = 'var(--success)';
            } else if (bmi < 30) {
                whoCategory = 'Overweight';
                whoColor = 'var(--warning)';
            } else {
                whoCategory = 'Obese';
                whoColor = 'var(--error)';
            }
            
            // Asian-Pacific Classification
            let asianCategory = '';
            if (bmi < 18.5) {
                asianCategory = 'Underweight';
            } else if (bmi < 23) {
                asianCategory = 'Normal weight';
            } else if (bmi < 25) {
                asianCategory = 'Overweight (at risk)';
            } else if (bmi < 30) {
                asianCategory = 'Obese I';
            } else {
                asianCategory = 'Obese II';
            }
            
            const resultHTML = `
                <div class="stat-card" style="background: ${whoColor};">
                    <span class="stat-number">${bmi.toFixed(1)}</span>
                    <span class="stat-label">BMI</span>
                    <span class="stat-subtitle">${whoCategory}</span>
                </div>
                
                <div class="mt-4 grid grid-cols-1 gap-4">
                    <div class="alert alert-info">
                        <div>
                            <strong>WHO Classification:</strong> ${whoCategory}<br>
                            <strong>Asian-Pacific Classification:</strong> ${asianCategory}
                        </div>
                    </div>
                    
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <h4 class="font-semibold mb-2">Healthy Weight Range:</h4>
                        <p class="text-sm">
                            ${(18.5 * heightM * heightM).toFixed(1)}kg - ${(24.9 * heightM * heightM).toFixed(1)}kg
                            ${units === 'imperial' ? `(${(18.5 * heightM * heightM / 0.453592).toFixed(1)} - ${(24.9 * heightM * heightM / 0.453592).toFixed(1)} lbs)` : ''}
                        </p>
                    </div>
                </div>
            `;
            
            document.getElementById('bmi-result').innerHTML = resultHTML;
        }
        
        /**
         * BMR Calculator with multiple formulas
         */
        function calculateBMR() {
            const age = parseInt(document.getElementById('bmr-age').value);
            const gender = document.getElementById('bmr-gender').value;
            const weight = parseFloat(document.getElementById('bmr-weight').value);
            const height = parseFloat(document.getElementById('bmr-height').value);
            const activityLevel = parseFloat(document.getElementById('activity-level').value);
            const formula = document.getElementById('bmr-formula').value;
            const bodyFat = parseFloat(document.getElementById('bmr-body-fat').value);
            
            if (!age || !weight || !height) {
                showAlert('Please fill in all required fields.', 'warning');
                return;
            }
            
            if (formula === 'katch' && !bodyFat) {
                showAlert('Body fat percentage is required for Katch-McArdle formula.', 'warning');
                return;
            }
            
            let bmr;
            let formulaName;
            
            switch (formula) {
                case 'mifflin':
                    // Mifflin-St Jeor Equation (most accurate for general population)
                    if (gender === 'male') {
                        bmr = (10 * weight) + (6.25 * height) - (5 * age) + 5;
                    } else {
                        bmr = (10 * weight) + (6.25 * height) - (5 * age) - 161;
                    }
                    formulaName = 'Mifflin-St Jeor';
                    break;
                    
                case 'harris':
                    // Harris-Benedict Equation (Revised)
                    if (gender === 'male') {
                        bmr = 88.362 + (13.397 * weight) + (4.799 * height) - (5.677 * age);
                    } else {
                        bmr = 447.593 + (9.247 * weight) + (3.098 * height) - (4.330 * age);
                    }
                    formulaName = 'Harris-Benedict (Revised)';
                    break;
                    
                case 'katch':
                    // Katch-McArdle Formula (most accurate for lean individuals)
                    const leanBodyMass = weight * (1 - bodyFat / 100);
                    bmr = 370 + (21.6 * leanBodyMass);
                    formulaName = 'Katch-McArdle';
                    break;
            }
            
            const tdee = bmr * activityLevel;
            
            // Calculate different goals
            const extremeLoss = tdee - 1000;
            const moderateLoss = tdee - 750;
            const mildLoss = tdee - 500;
            const maintenance = tdee;
            const mildGain = tdee + 300;
            const moderateGain = tdee + 500;
            
            const resultHTML = `
                <div class="grid grid-cols-2 gap-4 mb-4">
                    <div class="stat-card" style="background: var(--primary-500);">
                        <span class="stat-number">${Math.round(bmr)}</span>
                        <span class="stat-label">BMR</span>
                        <span class="stat-subtitle">${formulaName}</span>
                    </div>
                    <div class="stat-card" style="background: var(--secondary-500);">
                        <span class="stat-number">${Math.round(tdee)}</span>
                        <span class="stat-label">TDEE</span>
                        <span class="stat-subtitle">Maintenance</span>
                    </div>
                </div>
                
                <div class="bg-gray-50 p-4 rounded-lg">
                    <h4 class="font-semibold mb-3">Calorie Goals by Objective:</h4>
                    <div class="grid grid-cols-2 gap-2 text-sm">
                        <div class="flex justify-between">
                            <span>Extreme Loss (-2 lb/week):</span>
                            <strong>${Math.round(Math.max(extremeLoss, bmr * 1.2))} cal</strong>
                        </div>
                        <div class="flex justify-between">
                            <span>Moderate Loss (-1.5 lb/week):</span>
                            <strong>${Math.round(Math.max(moderateLoss, bmr * 1.2))} cal</strong>
                        </div>
                        <div class="flex justify-between">
                            <span>Mild Loss (-1 lb/week):</span>
                            <strong>${Math.round(mildLoss)} cal</strong>
                        </div>
                        <div class="flex justify-between">
                            <span>Maintenance:</span>
                            <strong>${Math.round(maintenance)} cal</strong>
                        </div>
                        <div class="flex justify-between">
                            <span>Mild Gain (+0.5 lb/week):</span>
                            <strong>${Math.round(mildGain)} cal</strong>
                        </div>
                        <div class="flex justify-between">
                            <span>Moderate Gain (+1 lb/week):</span>
                            <strong>${Math.round(moderateGain)} cal</strong>
                        </div>
                    </div>
                </div>
                
                <div class="alert alert-warning mt-4">
                    <div>
                        <strong>‚ö†Ô∏è Important:</strong> Extreme deficits should be medically supervised. Never go below your BMR for extended periods.
                    </div>
                </div>
            `;
            
            document.getElementById('bmr-result').innerHTML = resultHTML;
            
            // Save TDEE to user profile for macro calculator
            userProfile.bmr = Math.round(bmr);
            userProfile.tdee = Math.round(tdee);
            saveUserData();
        }
        
        /**
         * Macro Calculator with preset diet plans
         */
        function calculateMacros() {
            const calories = parseInt(document.getElementById('macro-calories').value);
            const carbPercent = parseInt(document.getElementById('carb-percent').value);
            const proteinPercent = parseInt(document.getElementById('protein-percent').value);
            const fatPercent = parseInt(document.getElementById('fat-percent').value);
            
            if (!calories) {
                showAlert('Please enter daily calorie target.', 'warning');
                return;
            }
            
            if (carbPercent + proteinPercent + fatPercent !== 100) {
                showAlert('Macro percentages must add up to 100%.', 'warning');
                return;
            }
            
            const carbCalories = calories * (carbPercent / 100);
            const proteinCalories = calories * (proteinPercent / 100);
            const fatCalories = calories * (fatPercent / 100);
            
            const carbGrams = Math.round(carbCalories / 4);
            const proteinGrams = Math.round(proteinCalories / 4);
            const fatGrams = Math.round(fatCalories / 9);
            
            const resultHTML = `
                <div class="grid grid-cols-3 gap-4 mb-4">
                    <div class="stat-card" style="background: var(--warning);">
                        <span class="stat-number">${carbGrams}g</span>
                        <span class="stat-label">Carbs</span>
                        <span class="stat-subtitle">${Math.round(carbCalories)} cal</span>
                    </div>
                    <div class="stat-card" style="background: var(--info);">
                        <span class="stat-number">${proteinGrams}g</span>
                        <span class="stat-label">Protein</span>
                        <span class="stat-subtitle">${Math.round(proteinCalories)} cal</span>
                    </div>
                    <div class="stat-card" style="background: var(--secondary-500);">
                        <span class="stat-number">${fatGrams}g</span>
                        <span class="stat-label">Fat</span>
                        <span class="stat-subtitle">${Math.round(fatCalories)} cal</span>
                    </div>
                </div>
                
                <div class="bg-gray-50 p-4 rounded-lg">
                    <h4 class="font-semibold mb-2">Daily Distribution:</h4>
                    <div class="text-sm">
                        <div class="flex justify-between mb-1">
                            <span>Per meal (3 meals):</span>
                            <span>${Math.round(carbGrams/3)}g carbs, ${Math.round(proteinGrams/3)}g protein, ${Math.round(fatGrams/3)}g fat</span>
                        </div>
                        <div class="flex justify-between">
                            <span>Per meal + snacks (6 times):</span>
                            <span>${Math.round(carbGrams/6)}g carbs, ${Math.round(proteinGrams/6)}g protein, ${Math.round(fatGrams/6)}g fat</span>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('macro-result').innerHTML = resultHTML;
            
            // Save macro goals
            userProfile.macroGoals = {
                calories: calories,
                carbs: carbGrams,
                protein: proteinGrams,
                fat: fatGrams
            };
            userProfile.calorieGoal = calories;
            userProfile.proteinGoal = proteinGrams;
            saveUserData();
            
            showAlert('Macro targets calculated and saved!', 'success');
        }
        
        /**
         * Body Composition Analysis
         */
        function calculateBodyComposition() {
            const weight = parseFloat(document.getElementById('bc-weight').value);
            const height = parseFloat(document.getElementById('bc-height').value);
            const bodyFat = parseFloat(document.getElementById('bc-body-fat').value);
            const age = parseInt(document.getElementById('bc-age').value);
            const gender = document.getElementById('bc-gender').value;
            
            if (!weight || !height || !age) {
                showAlert('Please fill in weight, height, and age.', 'warning');
                return;
            }
            
            const heightM = height / 100;
            const bmi = weight / (heightM * heightM);
            
            let results = `
                <div class="grid grid-cols-2 gap-4 mb-4">
                    <div class="stat-card">
                        <span class="stat-number">${bmi.toFixed(1)}</span>
                        <span class="stat-label">BMI</span>
                    </div>
            `;
            
            if (bodyFat) {
                const leanMass = weight * (1 - bodyFat / 100);
                const fatMass = weight - leanMass;
                
                // Estimate metabolic age (simplified)
                let metabolicAge = age;
                if (gender === 'male') {
                    metabolicAge = age + (bodyFat - 15) * 0.5;
                } else {
                    metabolicAge = age + (bodyFat - 23) * 0.5;
                }
                metabolicAge = Math.max(18, Math.min(80, Math.round(metabolicAge)));
                
                results += `
                    <div class="stat-card" style="background: var(--info);">
                        <span class="stat-number">${bodyFat.toFixed(1)}%</span>
                        <span class="stat-label">Body Fat</span>
                    </div>
                </div>
                
                <div class="grid grid-cols-2 gap-4 mb-4">
                    <div class="stat-card" style="background: var(--success);">
                        <span class="stat-number">${leanMass.toFixed(1)}kg</span>
                        <span class="stat-label">Lean Mass</span>
                    </div>
                    <div class="stat-card" style="background: var(--warning);">
                        <span class="stat-number">${metabolicAge}</span>
                        <span class="stat-label">Metabolic Age</span>
                    </div>
                </div>
                
                <div class="bg-gray-50 p-4 rounded-lg">
                    <h4 class="font-semibold mb-2">Body Fat Analysis:</h4>
                    <div class="text-sm">
                        <div class="mb-2">
                            <strong>Fat Mass:</strong> ${fatMass.toFixed(1)}kg
                        </div>
                        <div class="mb-2">
                            <strong>Lean Mass:</strong> ${leanMass.toFixed(1)}kg (${(leanMass/weight*100).toFixed(1)}%)
                        </div>
                `;
                
                // Body fat category
                let bfCategory = '';
                if (gender === 'male') {
                    if (bodyFat < 6) bfCategory = 'Essential fat (athlete level)';
                    else if (bodyFat < 14) bfCategory = 'Athletic';
                    else if (bodyFat < 18) bfCategory = 'Fitness';
                    else if (bodyFat < 25) bfCategory = 'Acceptable';
                    else bfCategory = 'Above average';
                } else {
                    if (bodyFat < 16) bfCategory = 'Essential/Athletic';
                    else if (bodyFat < 20) bfCategory = 'Athletic';
                    else if (bodyFat < 25) bfCategory = 'Fitness';
                    else if (bodyFat < 32) bfCategory = 'Acceptable';
                    else bfCategory = 'Above average';
                }
                
                results += `
                        <div><strong>Category:</strong> ${bfCategory}</div>
                    </div>
                </div>
                `;
            } else {
                results += `
                    <div class="stat-card" style="background: var(--neutral-400);">
                        <span class="stat-number">?</span>
                        <span class="stat-label">Body Fat</span>
                        <span class="stat-subtitle">Not provided</span>
                    </div>
                </div>
                
                <div class="alert alert-info">
                    <div>
                        <strong>üí° Tip:</strong> Add your body fat percentage for detailed composition analysis including lean mass and metabolic age estimates.
                    </div>
                </div>
                `;
            }
            
            document.getElementById('body-composition-result').innerHTML = results;
        }
        
        /**
         * Hydration Calculator
         */
        function calculateHydration() {
            const weight = parseFloat(document.getElementById('hydra-weight').value);
            const exerciseDuration = parseInt(document.getElementById('exercise-duration').value) || 0;
            const climate = document.getElementById('climate').value;
            const sweatRate = document.getElementById('sweat-rate').value;
            
            if (!weight) {
                showAlert('Please enter your weight.', 'warning');
                return;
            }
            
            // Base water need: 35ml per kg of body weight
            let waterNeeds = weight * 35;
            
            // Exercise adjustment (500-1000ml per hour depending on intensity)
            const exerciseHours = exerciseDuration / 60;
            let exerciseMultiplier = 625; // ml per hour
            
            if (sweatRate === 'low') exerciseMultiplier = 500;
            else if (sweatRate === 'high') exerciseMultiplier = 1000;
            
            waterNeeds += exerciseHours * exerciseMultiplier;
            
            // Climate adjustment
            const climateMultipliers = {
                'moderate': 1.0,
                'hot': 1.3,
                'cold': 0.9,
                'extreme': 1.5
            };
            
            waterNeeds *= climateMultipliers[climate] || 1.0;
            
            const liters = (waterNeeds / 1000).toFixed(1);
            const glasses = Math.round(waterNeeds / 250);
            const bottles = Math.round(waterNeeds / 500);
            
            const resultHTML = `
                <div class="stat-card" style="background: var(--info);">
                    <span class="stat-number">${liters}L</span>
                    <span class="stat-label">Daily Water Goal</span>
                    <span class="stat-subtitle">${Math.round(waterNeeds)}ml total</span>
                </div>
                
                <div class="bg-gray-50 p-4 rounded-lg mt-4">
                    <h4 class="font-semibold mb-3">Practical Measurements:</h4>
                    <div class="grid grid-cols-2 gap-4 text-sm">
                        <div class="flex justify-between">
                            <span>ü•§ Glasses (250ml):</span>
                            <strong>${glasses}</strong>
                        </div>
                        <div class="flex justify-between">
                            <span>üç∂ Water bottles (500ml):</span>
                            <strong>${bottles}</strong>
                        </div>
                        <div class="flex justify-between">
                            <span>‚òï Coffee mugs (300ml):</span>
                            <strong>${Math.round(waterNeeds / 300)}</strong>
                        </div>
                        <div class="flex justify-between">
                            <span>üè∫ Large bottles (1L):</span>
                            <strong>${Math.ceil(parseFloat(liters))}</strong>
                        </div>
                    </div>
                </div>
                
                <div class="alert alert-info mt-4">
                    <div>
                        <strong>üí° Hydration Tips:</strong><br>
                        ‚Ä¢ Start your day with 500ml water<br>
                        ‚Ä¢ Drink 250ml every hour during exercise<br>
                        ‚Ä¢ Monitor urine color (pale yellow is ideal)<br>
                        ‚Ä¢ Increase intake with caffeine/alcohol consumption
                    </div>
                </div>
            `;
            
            document.getElementById('hydration-result').innerHTML = resultHTML;
            
            // Save water goal
            userProfile.waterGoal = parseFloat(liters);
            saveUserData();
        }
        
        /**
         * Ideal Weight Calculator using multiple formulas
         */
        function calculateIdealWeight() {
            const height = parseFloat(document.getElementById('iw-height').value);
            const gender = document.getElementById('iw-gender').value;
            const frame = document.getElementById('iw-frame').value;
            
            if (!height) {
                showAlert('Please enter your height.', 'warning');
                return;
            }
            
            const heightM = height / 100;
            const heightInches = height / 2.54;
            
            // Hamwi Formula (1964)
            let hamwi;
            if (gender === 'male') {
                hamwi = 48 + 2.7 * (heightInches - 60);
            } else {
                hamwi = 45.5 + 2.2 * (heightInches - 60);
            }
            
            // Devine Formula (1974)
            let devine;
            if (gender === 'male') {
                devine = 50 + 2.3 * (heightInches - 60);
            } else {
                devine = 45.5 + 2.3 * (heightInches - 60);
            }
            
            // Robinson Formula (1983)
            let robinson;
            if (gender === 'male') {
                robinson = 52 + 1.9 * (heightInches - 60);
            } else {
                robinson = 49 + 1.7 * (heightInches - 60);
            }
            
            // Miller Formula (1983)
            let miller;
            if (gender === 'male') {
                miller = 56.2 + 1.41 * (heightInches - 60);
            } else {
                miller = 53.1 + 1.36 * (heightInches - 60);
            }
            
            // BMI-based healthy range (18.5-24.9)
            const bmiLow = 18.5 * heightM * heightM;
            const bmiHigh = 24.9 * heightM * heightM;
            
            // Average of formulas
            const average = (hamwi + devine + robinson + miller) / 4;
            
            // Frame adjustments
            const frameAdjustments = {
                'small': -0.1,
                'medium': 0,
                'large': 0.1
            };
            
            const frameAdjustment = frameAdjustments[frame] || 0;
            const adjustedMin = Math.round((average * (1 + frameAdjustment - 0.1)) * 10) / 10;
            const adjustedMax = Math.round((average * (1 + frameAdjustment + 0.1)) * 10) / 10;
            
            const resultHTML = `
                <div class="grid grid-cols-2 gap-4 mb-4">
                    <div class="stat-card" style="background: var(--success);">
                        <span class="stat-number">${adjustedMin} - ${adjustedMax}</span>
                        <span class="stat-label">Ideal Weight Range</span>
                        <span class="stat-subtitle">${frame} frame</span>
                    </div>
                    <div class="stat-card" style="background: var(--info);">
                        <span class="stat-number">${bmiLow.toFixed(1)} - ${bmiHigh.toFixed(1)}</span>
                        <span class="stat-label">BMI Healthy Range</span>
                        <span class="stat-subtitle">18.5 - 24.9 BMI</span>
                    </div>
                </div>
                
                <div class="bg-gray-50 p-4 rounded-lg">
                    <h4 class="font-semibold mb-3">Formula Comparisons (kg):</h4>
                    <div class="grid grid-cols-2 gap-2 text-sm">
                        <div class="flex justify-between">
                            <span>Hamwi (1964):</span>
                            <strong>${hamwi.toFixed(1)}</strong>
                        </div>
                        <div class="flex justify-between">
                            <span>Devine (1974):</span>
                            <strong>${devine.toFixed(1)}</strong>
                        </div>
                        <div class="flex justify-between">
                            <span>Robinson (1983):</span>
                            <strong>${robinson.toFixed(1)}</strong>
                        </div>
                        <div class="flex justify-between">
                            <span>Miller (1983):</span>
                            <strong>${miller.toFixed(1)}</strong>
                        </div>
                    </div>
                </div>
                
                <div class="alert alert-info mt-4">
                    <div>
                        <strong>üìù Note:</strong> Ideal weight formulas are estimates. Factors like muscle mass, bone density, and overall health are more important than hitting a specific number.
                    </div>
                </div>
            `;
            
            document.getElementById('ideal-weight-result').innerHTML = resultHTML;
        }
        
        // ===== CALCULATOR HELPER FUNCTIONS =====
        
        /**
         * Toggle body fat input for Katch-McArdle formula
         */
        function toggleBodyFatInput() {
            const formula = document.getElementById('bmr-formula').value;
            const bodyFatGroup = document.getElementById('body-fat-group');
            
            if (formula === 'katch') {
                bodyFatGroup.style.display = 'block';
            } else {
                bodyFatGroup.style.display = 'none';
            }
        }
        
        /**
         * Apply macro preset ratios
         */
        function applyMacroPreset() {
            const preset = document.getElementById('macro-preset').value;
            
            const presets = {
                'balanced': [40, 30, 30],        // Carbs, Protein, Fat
                'keto': [5, 20, 75],
                'paleo': [25, 30, 45],
                'mediterranean': [45, 20, 35],
                'dash': [55, 18, 27],
                'high-protein': [30, 40, 30],
                'low-carb': [20, 40, 40]
            };
            
            if (presets[preset]) {
                document.getElementById('carb-percent').value = presets[preset][0];
                document.getElementById('protein-percent').value = presets[preset][1];
                document.getElementById('fat-percent').value = presets[preset][2];
                validateMacroPercentages();
            }
        }
        
        /**
         * Validate macro percentages add to 100
         */
        function validateMacroPercentages() {
            const carbs = parseInt(document.getElementById('carb-percent').value) || 0;
            const protein = parseInt(document.getElementById('protein-percent').value) || 0;
            const fat = parseInt(document.getElementById('fat-percent').value) || 0;
            
            const total = carbs + protein + fat;
            const validationDiv = document.getElementById('macro-validation');
            
            if (total === 100) {
                validationDiv.innerHTML = '<div class="alert alert-success">‚úÖ Percentages total 100% - Perfect!</div>';
            } else {
                validationDiv.innerHTML = `<div class="alert alert-warning">‚ö†Ô∏è Percentages total ${total}% - Should be 100%</div>`;
            }
        }
        
        /**
         * Toggle units between metric and imperial
         */
        function toggleUnits(calculator) {
            const units = document.getElementById(`${calculator}-units`).value;
            const weightUnit = document.getElementById(`${calculator}-weight-unit`);
            const heightUnit = document.getElementById(`${calculator}-height-unit`);
            const weightInput = document.getElementById(`${calculator}-weight`);
            const heightInput = document.getElementById(`${calculator}-height`);
            
            if (units === 'imperial') {
                weightUnit.textContent = 'lbs';
                heightUnit.textContent = 'in';
                weightInput.placeholder = '154';
                heightInput.placeholder = '69';
            } else {
                weightUnit.textContent = 'kg';
                heightUnit.textContent = 'cm';
                weightInput.placeholder = '70';
                heightInput.placeholder = '175';
            }
        }
        
        // ===== COMPREHENSIVE FOOD DATABASE =====
        
        // Extensive food database with complete nutritional profiles
        const FOOD_DATABASE = [
            // Fruits
            { id: 1, name: 'Apple', brand: 'Fresh', category: 'fruit', calories: 52, protein: 0.3, carbs: 14, fat: 0.2, fiber: 2.4, sugar: 10, sodium: 1, cholesterol: 0, vitaminC: 4.6, vitaminA: 3, iron: 0.12, calcium: 6, potassium: 107, tags: ['fresh', 'raw', 'healthy'], allergens: [], vegan: true, keto: false, serving: '1 medium (182g)' },
            { id: 2, name: 'Banana', brand: 'Fresh', category: 'fruit', calories: 89, protein: 1.1, carbs: 23, fat: 0.3, fiber: 2.6, sugar: 12, sodium: 1, cholesterol: 0, vitaminC: 8.7, vitaminB6: 0.4, potassium: 358, magnesium: 27, tags: ['fresh', 'potassium', 'energy'], allergens: [], vegan: true, keto: false, serving: '1 medium (118g)' },
            { id: 3, name: 'Orange', brand: 'Fresh', category: 'fruit', calories: 47, protein: 0.9, carbs: 12, fat: 0.1, fiber: 2.4, sugar: 9, sodium: 0, cholesterol: 0, vitaminC: 53.2, folate: 40, calcium: 40, potassium: 181, tags: ['citrus', 'vitamin-c', 'fresh'], allergens: [], vegan: true, keto: false, serving: '1 medium (154g)' },
            { id: 4, name: 'Blueberries', brand: 'Fresh', category: 'fruit', calories: 57, protein: 0.7, carbs: 14, fat: 0.3, fiber: 2.4, sugar: 10, sodium: 1, cholesterol: 0, vitaminC: 9.7, vitaminK: 19.3, manganese: 0.3, tags: ['berries', 'antioxidants', 'superfood'], allergens: [], vegan: true, keto: false, serving: '1 cup (148g)' },
            { id: 5, name: 'Strawberries', brand: 'Fresh', category: 'fruit', calories: 32, protein: 0.7, carbs: 7.7, fat: 0.3, fiber: 2, sugar: 4.9, sodium: 1, cholesterol: 0, vitaminC: 58.8, folate: 24, potassium: 153, tags: ['berries', 'vitamin-c', 'low-calorie'], allergens: [], vegan: true, keto: true, serving: '1 cup (144g)' },
            
            // Vegetables
            { id: 6, name: 'Broccoli', brand: 'Fresh', category: 'vegetable', calories: 34, protein: 2.8, carbs: 7, fat: 0.4, fiber: 2.6, sugar: 1.5, sodium: 33, cholesterol: 0, vitaminC: 89.2, vitaminK: 101.6, folate: 63, calcium: 47, tags: ['cruciferous', 'vitamin-c', 'healthy'], allergens: [], vegan: true, keto: true, serving: '1 cup chopped (91g)' },
            { id: 7, name: 'Spinach', brand: 'Fresh', category: 'vegetable', calories: 23, protein: 2.9, carbs: 3.6, fat: 0.4, fiber: 2.2, sugar: 0.4, sodium: 79, cholesterol: 0, vitaminK: 483, folate: 194, iron: 2.7, vitaminA: 469, tags: ['leafy-green', 'iron', 'folate'], allergens: [], vegan: true, keto: true, serving: '1 cup raw (30g)' },
            { id: 8, name: 'Carrots', brand: 'Fresh', category: 'vegetable', calories: 41, protein: 0.9, carbs: 10, fat: 0.2, fiber: 2.8, sugar: 4.7, sodium: 69, cholesterol: 0, vitaminA: 835, betaCarotene: 8285, potassium: 320, tags: ['root-vegetable', 'vitamin-a', 'beta-carotene'], allergens: [], vegan: true, keto: false, serving: '1 medium (61g)' },
            { id: 9, name: 'Bell Pepper (Red)', brand: 'Fresh', category: 'vegetable', calories: 31, protein: 1, carbs: 7, fat: 0.3, fiber: 2.5, sugar: 4.2, sodium: 4, cholesterol: 0, vitaminC: 127.7, vitaminA: 59, vitaminB6: 0.3, tags: ['pepper', 'vitamin-c', 'colorful'], allergens: [], vegan: true, keto: true, serving: '1 medium (119g)' },
            { id: 10, name: 'Kale', brand: 'Fresh', category: 'vegetable', calories: 35, protein: 2.9, carbs: 7, fat: 0.4, fiber: 3.6, sugar: 2.3, sodium: 38, cholesterol: 0, vitaminK: 684, vitaminA: 241, vitaminC: 80.4, calcium: 150, tags: ['superfood', 'leafy-green', 'nutrient-dense'], allergens: [], vegan: true, keto: true, serving: '1 cup chopped (67g)' },
            
            // Proteins
            { id: 11, name: 'Chicken Breast', brand: 'Fresh', category: 'protein', calories: 165, protein: 31, carbs: 0, fat: 3.6, fiber: 0, sugar: 0, sodium: 74, cholesterol: 85, vitaminB6: 1.04, niacin: 14.8, phosphorus: 228, selenium: 24, tags: ['lean-protein', 'poultry', 'high-protein'], allergens: [], vegan: false, keto: true, serving: '100g cooked' },
            { id: 12, name: 'Salmon (Atlantic)', brand: 'Fresh', category: 'protein', calories: 208, protein: 25, carbs: 0, fat: 12, fiber: 0, sugar: 0, sodium: 59, cholesterol: 55, omega3: 2260, vitaminD: 360, vitaminB12: 4.8, selenium: 39, tags: ['fish', 'omega-3', 'heart-healthy'], allergens: ['fish'], vegan: false, keto: true, serving: '100g cooked' },
            { id: 13, name: 'Eggs', brand: 'Fresh', category: 'protein', calories: 155, protein: 13, carbs: 1.1, fat: 11, fiber: 0, sugar: 1.1, sodium: 124, cholesterol: 372, vitaminB12: 0.6, selenium: 15.4, choline: 251, vitaminD: 20, tags: ['complete-protein', 'versatile', 'breakfast'], allergens: ['eggs'], vegan: false, keto: true, serving: '2 large eggs (100g)' },
            { id: 14, name: 'Greek Yogurt (Plain)', brand: 'Fage', category: 'dairy', calories: 59, protein: 10, carbs: 3.6, fat: 0.4, fiber: 0, sugar: 3.2, sodium: 36, cholesterol: 5, calcium: 110, vitaminB12: 0.8, riboflavin: 0.3, tags: ['probiotic', 'high-protein', 'low-fat'], allergens: ['dairy'], vegan: false, keto: false, serving: '100g' },
            { id: 15, name: 'Tofu (Firm)', brand: 'House Foods', category: 'protein', calories: 70, protein: 8, carbs: 1.9, fat: 4, fiber: 0.3, sugar: 0.6, sodium: 7, cholesterol: 0, calcium: 201, iron: 1.4, magnesium: 30, tags: ['plant-protein', 'soy', 'versatile'], allergens: ['soy'], vegan: true, keto: true, serving: '100g' },
            
            // Grains & Starches
            { id: 16, name: 'Brown Rice', brand: 'Generic', category: 'grain', calories: 112, protein: 2.6, carbs: 23, fat: 0.9, fiber: 1.8, sugar: 0.4, sodium: 1, cholesterol: 0, magnesium: 43, manganese: 1.8, selenium: 10, niacin: 3, tags: ['whole-grain', 'complex-carb', 'gluten-free'], allergens: [], vegan: true, keto: false, serving: '100g cooked' },
            { id: 17, name: 'Quinoa', brand: 'Generic', category: 'grain', calories: 120, protein: 4.4, carbs: 22, fat: 1.9, fiber: 2.8, sugar: 0.9, sodium: 7, cholesterol: 0, magnesium: 64, iron: 1.5, folate: 42, manganese: 0.6, tags: ['complete-protein', 'ancient-grain', 'gluten-free'], allergens: [], vegan: true, keto: false, serving: '100g cooked' },
            { id: 18, name: 'Oatmeal', brand: 'Generic', category: 'grain', calories: 68, protein: 2.4, carbs: 12, fat: 1.4, fiber: 1.7, sugar: 0.3, sodium: 2, cholesterol: 0, manganese: 0.9, phosphorus: 77, magnesium: 27, zinc: 0.6, tags: ['breakfast', 'fiber', 'heart-healthy'], allergens: ['gluten'], vegan: true, keto: false, serving: '100g cooked' },
            { id: 19, name: 'Sweet Potato', brand: 'Fresh', category: 'vegetable', calories: 86, protein: 1.6, carbs: 20, fat: 0.1, fiber: 3, sugar: 4.2, sodium: 5, cholesterol: 0, vitaminA: 709, vitaminC: 2.4, potassium: 337, manganese: 0.3, tags: ['root-vegetable', 'vitamin-a', 'complex-carb'], allergens: [], vegan: true, keto: false, serving: '100g baked' },
            { id: 20, name: 'Whole Wheat Bread', brand: 'Generic', category: 'grain', calories: 247, protein: 13, carbs: 41, fat: 4.2, fiber: 6, sugar: 5.7, sodium: 396, cholesterol: 0, niacin: 5.4, thiamine: 0.4, iron: 3.6, magnesium: 79, tags: ['whole-grain', 'fiber', 'staple'], allergens: ['gluten'], vegan: true, keto: false, serving: '100g (4 slices)' },
            
            // Nuts & Seeds
            { id: 21, name: 'Almonds', brand: 'Generic', category: 'nuts', calories: 579, protein: 21, carbs: 22, fat: 50, fiber: 12, sugar: 4.4, sodium: 1, cholesterol: 0, vitaminE: 25.6, magnesium: 270, calcium: 269, manganese: 2.3, tags: ['healthy-fats', 'vitamin-e', 'protein'], allergens: ['nuts'], vegan: true, keto: true, serving: '100g (about 23 nuts)' },
            { id: 22, name: 'Walnuts', brand: 'Generic', category: 'nuts', calories: 654, protein: 15, carbs: 14, fat: 65, fiber: 6.7, sugar: 2.6, sodium: 2, cholesterol: 0, omega3: 9080, magnesium: 158, phosphorus: 346, manganese: 3.4, tags: ['omega-3', 'brain-food', 'healthy-fats'], allergens: ['nuts'], vegan: true, keto: true, serving: '100g (about 14 halves)' },
            { id: 23, name: 'Chia Seeds', brand: 'Generic', category: 'seeds', calories: 486, protein: 17, carbs: 42, fat: 31, fiber: 34, sugar: 0, sodium: 16, cholesterol: 0, omega3: 17552, calcium: 631, magnesium: 335, phosphorus: 860, tags: ['superfood', 'omega-3', 'fiber'], allergens: [], vegan: true, keto: true, serving: '100g (about 12 tbsp)' },
            { id: 24, name: 'Flaxseeds', brand: 'Generic', category: 'seeds', calories: 534, protein: 18, carbs: 29, fat: 42, fiber: 27, sugar: 1.6, sodium: 30, cholesterol: 0, omega3: 22813, magnesium: 392, thiamine: 1.6, manganese: 2.5, tags: ['omega-3', 'lignans', 'fiber'], allergens: [], vegan: true, keto: true, serving: '100g (about 16 tbsp)' },
            
            // Legumes
            { id: 25, name: 'Black Beans', brand: 'Generic', category: 'legume', calories: 132, protein: 8.9, carbs: 24, fat: 0.5, fiber: 8.7, sugar: 0.3, sodium: 2, cholesterol: 0, folate: 149, magnesium: 70, iron: 2.1, potassium: 355, tags: ['plant-protein', 'fiber', 'folate'], allergens: [], vegan: true, keto: false, serving: '100g cooked' },
            { id: 26, name: 'Lentils (Red)', brand: 'Generic', category: 'legume', calories: 116, protein: 9, carbs: 20, fat: 0.4, fiber: 8, sugar: 1.8, sodium: 2, cholesterol: 0, folate: 181, iron: 3.3, magnesium: 36, potassium: 365, tags: ['plant-protein', 'iron', 'quick-cooking'], allergens: [], vegan: true, keto: false, serving: '100g cooked' },
            { id: 27, name: 'Chickpeas', brand: 'Generic', category: 'legume', calories: 164, protein: 8.9, carbs: 27, fat: 2.6, fiber: 7.6, sugar: 4.8, sodium: 7, cholesterol: 0, folate: 172, magnesium: 48, iron: 2.9, potassium: 291, tags: ['plant-protein', 'versatile', 'mediterranean'], allergens: [], vegan: true, keto: false, serving: '100g cooked' },
            
            // Processed Foods
            { id: 28, name: 'Whey Protein Powder', brand: 'Optimum Nutrition', category: 'supplement', calories: 120, protein: 24, carbs: 3, fat: 1, fiber: 1, sugar: 1, sodium: 130, cholesterol: 5, calcium: 120, iron: 0.5, tags: ['supplement', 'post-workout', 'quick-protein'], allergens: ['dairy'], vegan: false, keto: true, serving: '30g scoop' },
            { id: 29, name: 'Olive Oil', brand: 'Extra Virgin', category: 'oil', calories: 884, protein: 0, carbs: 0, fat: 100, fiber: 0, sugar: 0, sodium: 2, cholesterol: 0, vitaminE: 14.4, vitaminK: 60.2, tags: ['healthy-fats', 'mediterranean', 'cooking'], allergens: [], vegan: true, keto: true, serving: '100g (about 7 tbsp)' },
            { id: 30, name: 'Avocado', brand: 'Fresh', category: 'fruit', calories: 160, protein: 2, carbs: 9, fat: 15, fiber: 7, sugar: 0.7, sodium: 7, cholesterol: 0, vitaminK: 21, folate: 20, potassium: 485, vitaminE: 2.1, tags: ['healthy-fats', 'fiber', 'keto-friendly'], allergens: [], vegan: true, keto: true, serving: '100g (about 2/3 medium)' }
        ];
        
        // Restaurant database for chain restaurants
        const RESTAURANT_DATABASE = {
            mcdonalds: {
                name: "McDonald's",
                items: [
                    { name: "Big Mac", calories: 563, protein: 25, carbs: 46, fat: 33, sodium: 1040, fiber: 3, sugar: 9 },
                    { name: "Quarter Pounder with Cheese", calories: 520, protein: 26, carbs: 42, fat: 26, sodium: 1040, fiber: 3, sugar: 10 },
                    { name: "Chicken McNuggets (10 piece)", calories: 440, protein: 19, carbs: 27, fat: 27, sodium: 840, fiber: 2, sugar: 0 },
                    { name: "McChicken", calories: 400, protein: 14, carbs: 43, fat: 20, sodium: 560, fiber: 2, sugar: 5 },
                    { name: "Caesar Salad (no dressing)", calories: 320, protein: 28, carbs: 13, fat: 18, sodium: 920, fiber: 3, sugar: 4 }
                ]
            },
            subway: {
                name: "Subway",
                items: [
                    { name: "Turkey Breast Sub (6\", wheat)", calories: 280, protein: 18, carbs: 46, fat: 3.5, sodium: 810, fiber: 5, sugar: 7 },
                    { name: "Chicken Teriyaki Sub (6\", wheat)", calories: 370, protein: 25, carbs: 59, fat: 4.5, sodium: 1260, fiber: 5, sugar: 16 },
                    { name: "Veggie Delite Sub (6\", wheat)", calories: 230, protein: 8, carbs: 44, fat: 2.5, sodium: 410, fiber: 5, sugar: 7 },
                    { name: "Tuna Sub (6\", wheat)", calories: 480, protein: 20, carbs: 46, fat: 25, sodium: 610, fiber: 5, sugar: 7 }
                ]
            },
            starbucks: {
                name: "Starbucks",
                items: [
                    { name: "Grande Caffe Latte", calories: 190, protein: 13, carbs: 18, fat: 7, sodium: 150, fiber: 0, sugar: 17 },
                    { name: "Spinach, Feta & Egg White Wrap", calories: 290, protein: 19, carbs: 33, fat: 10, sodium: 830, fiber: 6, sugar: 4 },
                    { name: "Blueberry Muffin", calories: 380, protein: 6, carbs: 56, fat: 16, sodium: 390, fiber: 2, sugar: 28 },
                    { name: "Protein Box - Eggs & Cheese", calories: 470, protein: 21, carbs: 44, fat: 22, sodium: 1020, fiber: 5, sugar: 11 }
                ]
            },
            chipotle: {
                name: "Chipotle",
                items: [
                    { name: "Chicken Bowl (no rice/beans)", calories: 630, protein: 45, carbs: 40, fat: 23, sodium: 1370, fiber: 3, sugar: 5 },
                    { name: "Carnitas Burrito", calories: 1120, protein: 32, carbs: 123, fat: 42, sodium: 2040, fiber: 10, sugar: 4 },
                    { name: "Veggie Bowl with Black Beans", calories: 430, protein: 14, carbs: 65, fat: 16, sodium: 1120, fiber: 23, sugar: 10 },
                    { name: "Barbacoa Salad", calories: 270, protein: 23, carbs: 12, fat: 16, sodium: 960, fiber: 6, sugar: 6 }
                ]
            }
        };
        
        // Current food tracking state
        let selectedFood = null;
        let searchTimeout = null;
        let recentFoods = JSON.parse(localStorage.getItem('recentFoods')) || [];
        let favoriteFoods = JSON.parse(localStorage.getItem('favoriteFoods')) || [];
        let todaysFoodLog = [];
        
        // Daily nutrition targets (from user profile or defaults)
        const DAILY_TARGETS = {
            calories: 2000,
            protein: 150,
            carbs: 200,
            fat: 67,
            fiber: 25,
            sugar: 50,
            sodium: 2300,
            cholesterol: 300,
            vitaminC: 90,
            vitaminD: 600,
            vitaminA: 900,
            vitaminB12: 2.4,
            iron: 8,
            calcium: 1000,
            magnesium: 400,
            potassium: 3500
        };
        
        // ===== FOOD SEARCH & TRACKING FUNCTIONS =====
        
        /**
         * Advanced food search with fuzzy matching
         */
        function searchFoods(query) {
            if (searchTimeout) clearTimeout(searchTimeout);
            
            searchTimeout = setTimeout(() => {
                const searchResults = document.getElementById('search-results');
                
                if (query.length < 2) {
                    searchResults.classList.add('hidden');
                    return;
                }
                
                // Fuzzy search implementation
                const results = FOOD_DATABASE.filter(food => {
                    const searchTerms = query.toLowerCase().split(' ');
                    const foodText = `${food.name} ${food.brand} ${food.category} ${food.tags.join(' ')}`.toLowerCase();
                    
                    return searchTerms.every(term => {
                        return foodText.includes(term) || 
                               food.name.toLowerCase().includes(term) ||
                               food.tags.some(tag => tag.includes(term));
                    });
                }).slice(0, 10); // Limit to top 10 results
                
                if (results.length === 0) {
                    searchResults.innerHTML = '<div class="p-3 text-gray-500 text-sm">No foods found. Try a different search term.</div>';
                } else {
                    searchResults.innerHTML = results.map(food => `
                        <div class="p-3 hover:bg-gray-50 cursor-pointer border-b border-gray-100 last:border-b-0" 
                             onclick="selectFood(${food.id})">
                            <div class="flex justify-between items-start">
                                <div>
                                    <div class="font-medium">${food.name}</div>
                                    <div class="text-sm text-gray-500">${food.brand} ‚Ä¢ ${food.category}</div>
                                    <div class="text-xs text-gray-400">${food.serving}</div>
                                </div>
                                <div class="text-right text-sm">
                                    <div class="font-medium">${food.calories} cal</div>
                                    <div class="text-gray-500">${food.protein}g protein</div>
                                </div>
                            </div>
                        </div>
                    `).join('');
                }
                
                searchResults.classList.remove('hidden');
            }, 300); // Debounce search
        }
        
        /**
         * Select a food item for logging
         */
        function selectFood(foodId) {
            selectedFood = FOOD_DATABASE.find(food => food.id === foodId);
            
            if (!selectedFood) return;
            
            // Hide search results
            document.getElementById('search-results').classList.add('hidden');
            document.getElementById('food-search').value = selectedFood.name;
            
            // Show food details panel
            document.getElementById('selected-food-details').classList.remove('hidden');
            document.getElementById('selected-food-name').textContent = selectedFood.name;
            document.getElementById('selected-food-brand').textContent = `${selectedFood.brand} ‚Ä¢ ${selectedFood.serving}`;
            
            // Update portion units based on food type
            updatePortionUnits(selectedFood);
            
            // Update nutrition display
            updateNutritionDisplay();
            
            // Add to recent foods
            addToRecentFoods(selectedFood);
        }
        
        /**
         * Update portion units dropdown based on food type
         */
        function updatePortionUnits(food) {
            const portionUnit = document.getElementById('portion-unit');
            let options = ['<option value="serving">Serving</option>'];
            
            // Add common units based on food category
            if (food.category === 'fruit' || food.category === 'vegetable') {
                options.push('<option value="cup">Cup</option>');
                options.push('<option value="piece">Piece</option>');
            } else if (food.category === 'grain') {
                options.push('<option value="cup">Cup</option>');
                options.push('<option value="slice">Slice</option>');
            } else if (food.category === 'protein') {
                options.push('<option value="ounce">Ounce</option>');
                options.push('<option value="piece">Piece</option>');
            } else if (food.category === 'dairy') {
                options.push('<option value="cup">Cup</option>');
                options.push('<option value="ounce">Ounce</option>');
            }
            
            options.push('<option value="gram">Gram</option>');
            options.push('<option value="tablespoon">Tablespoon</option>');
            options.push('<option value="teaspoon">Teaspoon</option>');
            
            portionUnit.innerHTML = options.join('');
        }
        
        /**
         * Update nutrition display based on selected portion
         */
        function updateNutritionDisplay() {
            if (!selectedFood) return;
            
            const amount = parseFloat(document.getElementById('portion-amount').value) || 1;
            const unit = document.getElementById('portion-unit').value;
            
            // Convert to serving multiplier
            let multiplier = amount;
            
            // Unit conversions (approximate)
            switch (unit) {
                case 'cup': multiplier = amount * 0.8; break;
                case 'gram': multiplier = amount * 0.01; break;
                case 'ounce': multiplier = amount * 0.28; break;
                case 'piece': multiplier = amount * 1; break;
                case 'slice': multiplier = amount * 0.3; break;
                case 'tablespoon': multiplier = amount * 0.06; break;
                case 'teaspoon': multiplier = amount * 0.02; break;
                default: multiplier = amount;
            }
            
            // Update nutrition preview
            document.getElementById('preview-calories').textContent = Math.round(selectedFood.calories * multiplier);
            document.getElementById('preview-protein').textContent = (selectedFood.protein * multiplier).toFixed(1) + 'g';
            document.getElementById('preview-carbs').textContent = (selectedFood.carbs * multiplier).toFixed(1) + 'g';
            document.getElementById('preview-fat').textContent = (selectedFood.fat * multiplier).toFixed(1) + 'g';
        }
        
        /**
         * Log the selected food to today's log
         */
        function logSelectedFood() {
            if (!selectedFood) return;
            
            const amount = parseFloat(document.getElementById('portion-amount').value) || 1;
            const unit = document.getElementById('portion-unit').value;
            const mealType = document.getElementById('meal-type').value;
            
            // Calculate multiplier
            let multiplier = amount;
            switch (unit) {
                case 'cup': multiplier = amount * 0.8; break;
                case 'gram': multiplier = amount * 0.01; break;
                case 'ounce': multiplier = amount * 0.28; break;
                case 'piece': multiplier = amount * 1; break;
                case 'slice': multiplier = amount * 0.3; break;
                case 'tablespoon': multiplier = amount * 0.06; break;
                case 'teaspoon': multiplier = amount * 0.02; break;
            }
            
            // Create food log entry
            const logEntry = {
                id: Date.now(),
                foodId: selectedFood.id,
                name: selectedFood.name,
                brand: selectedFood.brand,
                mealType: mealType,
                amount: amount,
                unit: unit,
                multiplier: multiplier,
                calories: Math.round(selectedFood.calories * multiplier),
                protein: +(selectedFood.protein * multiplier).toFixed(1),
                carbs: +(selectedFood.carbs * multiplier).toFixed(1),
                fat: +(selectedFood.fat * multiplier).toFixed(1),
                fiber: +(selectedFood.fiber * multiplier).toFixed(1),
                sugar: +(selectedFood.sugar * multiplier).toFixed(1),
                sodium: Math.round(selectedFood.sodium * multiplier),
                cholesterol: Math.round(selectedFood.cholesterol * multiplier),
                timestamp: new Date().toISOString(),
                date: new Date().toISOString().split('T')[0]
            };
            
            // Add to today's log
            todaysFoodLog.push(logEntry);
            
            // Update display
            displayTodaysLog();
            updateNutritionSummary();
            updateDashboard();
            
            // Save to localStorage
            saveFoodData();
            
            // Reset form
            resetFoodForm();
            
            showAlert(`${selectedFood.name} logged successfully!`, 'success');
        }
        
        // ===== PLACEHOLDER FUNCTIONS FOR FUTURE FEATURES =====
        
        function openBarcodeScanner() {
            showModal('üì± Barcode Scanner', `
                <div class="text-center py-8">
                    <div class="text-6xl mb-4">üì±</div>
                    <p class="mb-4">Barcode scanner functionality will be available in Phase 3B.</p>
                    <p class="text-sm text-gray-500">This feature will allow you to scan product barcodes for instant food logging.</p>
                </div>
            `);
        }
        
        /**
         * Reset the food logging form
         */
        function resetFoodForm() {
            document.getElementById('food-search').value = '';
            document.getElementById('selected-food-details').classList.add('hidden');
            document.getElementById('portion-amount').value = '1';
            document.getElementById('portion-unit').value = 'serving';
            selectedFood = null;
        }
        
        /**
         * Display today's food log
         */
        function displayTodaysLog() {
            const logContainer = document.getElementById('todays-food-log');
            
            if (todaysFoodLog.length === 0) {
                logContainer.innerHTML = `
                    <div class="text-center text-gray-500 py-8">
                        <div class="text-4xl mb-2">üçΩÔ∏è</div>
                        <p>No foods logged today</p>
                        <p class="text-sm">Start by searching for foods above</p>
                    </div>
                `;
                return;
            }
            
            // Group by meal type
            const groupedLog = todaysFoodLog.reduce((acc, entry) => {
                if (!acc[entry.mealType]) acc[entry.mealType] = [];
                acc[entry.mealType].push(entry);
                return acc;
            }, {});
            
            let logHTML = '';
            const mealOrder = ['breakfast', 'lunch', 'dinner', 'snack'];
            
            mealOrder.forEach(mealType => {
                if (groupedLog[mealType]) {
                    const mealCalories = groupedLog[mealType].reduce((sum, entry) => sum + entry.calories, 0);
                    
                    logHTML += `
                        <div class="mb-6">
                            <div class="flex justify-between items-center mb-3">
                                <h3 class="font-semibold text-lg capitalize">üçΩÔ∏è ${mealType}</h3>
                                <span class="text-sm font-medium">${mealCalories} calories</span>
                            </div>
                            <div class="space-y-2">
                    `;
                    
                    groupedLog[mealType].forEach(entry => {
                        logHTML += `
                            <div class="bg-gray-50 p-3 rounded-lg flex justify-between items-center">
                                <div>
                                    <div class="font-medium">${entry.name}</div>
                                    <div class="text-sm text-gray-600">${entry.amount} ${entry.unit} ‚Ä¢ ${entry.brand}</div>
                                </div>
                                <div class="text-right">
                                    <div class="font-medium">${entry.calories} cal</div>
                                    <div class="text-sm text-gray-600">${entry.protein}g P ‚Ä¢ ${entry.carbs}g C ‚Ä¢ ${entry.fat}g F</div>
                                </div>
                                <button class="btn btn-outline btn-sm ml-2" onclick="removeFoodEntry(${entry.id})">
                                    <span>√ó</span>
                                </button>
                            </div>
                        `;
                    });
                    
                    logHTML += `
                            </div>
                        </div>
                    `;
                }
            });
            
            logContainer.innerHTML = logHTML;
        }
        
        /**
         * Update nutrition summary and progress bars
         */
        function updateNutritionSummary() {
            // Calculate totals
            const totals = todaysFoodLog.reduce((acc, entry) => {
                acc.calories += entry.calories;
                acc.protein += entry.protein;
                acc.carbs += entry.carbs;
                acc.fat += entry.fat;
                acc.fiber += entry.fiber;
                acc.sugar += entry.sugar;
                acc.sodium += entry.sodium;
                acc.cholesterol += entry.cholesterol;
                return acc;
            }, { calories: 0, protein: 0, carbs: 0, fat: 0, fiber: 0, sugar: 0, sodium: 0, cholesterol: 0 });
            
            // Update progress bars
            const calorieProgress = Math.min((totals.calories / DAILY_TARGETS.calories) * 100, 100);
            const proteinProgress = Math.min((totals.protein / DAILY_TARGETS.protein) * 100, 100);
            const carbProgress = Math.min((totals.carbs / DAILY_TARGETS.carbs) * 100, 100);
            const fatProgress = Math.min((totals.fat / DAILY_TARGETS.fat) * 100, 100);
            
            document.getElementById('daily-calorie-progress').style.width = calorieProgress + '%';
            document.getElementById('daily-protein-progress').style.width = proteinProgress + '%';
            document.getElementById('daily-carb-progress').style.width = carbProgress + '%';
            document.getElementById('daily-fat-progress').style.width = fatProgress + '%';
            
            // Update progress text
            document.getElementById('calorie-progress-text').textContent = `${totals.calories} / ${DAILY_TARGETS.calories}`;
            document.getElementById('protein-progress-text').textContent = `${totals.protein.toFixed(1)}g / ${DAILY_TARGETS.protein}g`;
            document.getElementById('carb-progress-text').textContent = `${totals.carbs.toFixed(1)}g / ${DAILY_TARGETS.carbs}g`;
            document.getElementById('fat-progress-text').textContent = `${totals.fat.toFixed(1)}g / ${DAILY_TARGETS.fat}g`;
            
            // Update secondary nutrients
            document.getElementById('fiber-total').textContent = totals.fiber.toFixed(1) + 'g';
            document.getElementById('sugar-total').textContent = totals.sugar.toFixed(1) + 'g';
            document.getElementById('sodium-total').textContent = Math.round(totals.sodium) + 'mg';
            document.getElementById('cholesterol-total').textContent = Math.round(totals.cholesterol) + 'mg';
            
            // Update micronutrients (simplified calculation)
            updateMicronutrientBars(totals);
        }
        
        /**
         * Update micronutrient progress bars
         */
        function updateMicronutrientBars(totals) {
            // Calculate micronutrient totals from logged foods
            const microTotals = todaysFoodLog.reduce((acc, entry) => {
                const food = FOOD_DATABASE.find(f => f.id === entry.foodId);
                if (food) {
                    acc.vitaminC += (food.vitaminC || 0) * entry.multiplier;
                    acc.vitaminD += (food.vitaminD || 0) * entry.multiplier;
                    acc.vitaminA += (food.vitaminA || 0) * entry.multiplier;
                    acc.vitaminB12 += (food.vitaminB12 || 0) * entry.multiplier;
                    acc.iron += (food.iron || 0) * entry.multiplier;
                    acc.calcium += (food.calcium || 0) * entry.multiplier;
                    acc.magnesium += (food.magnesium || 0) * entry.multiplier;
                    acc.potassium += (food.potassium || 0) * entry.multiplier;
                }
                return acc;
            }, { vitaminC: 0, vitaminD: 0, vitaminA: 0, vitaminB12: 0, iron: 0, calcium: 0, magnesium: 0, potassium: 0 });
            
            // Update progress bars
            const nutrients = [
                { key: 'vitaminC', target: DAILY_TARGETS.vitaminC },
                { key: 'vitaminD', target: DAILY_TARGETS.vitaminD },
                { key: 'vitaminA', target: DAILY_TARGETS.vitaminA },
                { key: 'vitaminB12', target: DAILY_TARGETS.vitaminB12 },
                { key: 'iron', target: DAILY_TARGETS.iron },
                { key: 'calcium', target: DAILY_TARGETS.calcium },
                { key: 'magnesium', target: DAILY_TARGETS.magnesium },
                { key: 'potassium', target: DAILY_TARGETS.potassium }
            ];
            
            nutrients.forEach(nutrient => {
                const percent = Math.min((microTotals[nutrient.key] / nutrient.target) * 100, 100);
                const barId = nutrient.key.replace(/([A-Z])/g, '-$1').toLowerCase() + '-bar';
                const amountId = nutrient.key.replace(/([A-Z])/g, '-$1').toLowerCase() + '-amount';
                
                const barElement = document.getElementById(barId);
                const amountElement = document.getElementById(amountId);
                
                if (barElement) barElement.style.width = percent + '%';
                if (amountElement) amountElement.textContent = Math.round(percent) + '%';
            });
        }
        
        /**
         * Remove a food entry from the log
         */
        function removeFoodEntry(entryId) {
            todaysFoodLog = todaysFoodLog.filter(entry => entry.id !== entryId);
            displayTodaysLog();
            updateNutritionSummary();
            updateDashboard();
            saveFoodData();
            showAlert('Food removed from log', 'success');
        }
        
        /**
         * Add food to recent foods list
         */
        function addToRecentFoods(food) {
            // Remove if already exists and add to front
            recentFoods = recentFoods.filter(f => f.id !== food.id);
            recentFoods.unshift(food);
            
            // Keep only last 20 items
            if (recentFoods.length > 20) {
                recentFoods = recentFoods.slice(0, 20);
            }
            
            localStorage.setItem('recentFoods', JSON.stringify(recentFoods));
        }
        
        /**
         * Save food data to localStorage
         */
        function saveFoodData() {
            const today = new Date().toISOString().split('T')[0];
            const existingLog = JSON.parse(localStorage.getItem('foodLog')) || {};
            existingLog[today] = todaysFoodLog;
            localStorage.setItem('foodLog', JSON.stringify(existingLog));
        }
        
        /**
         * Load today's food data
         */
        function loadTodaysFoodData() {
            const today = new Date().toISOString().split('T')[0];
            const allFoodLog = JSON.parse(localStorage.getItem('foodLog')) || {};
            todaysFoodLog = allFoodLog[today] || [];
        }
        
        // ===== FILTER AND SEARCH FUNCTIONS =====
        
        /**
         * Filter foods by category
         */
        function filterFoods(filter) {
            let filteredFoods = [];
            
            switch (filter) {
                case 'recent':
                    filteredFoods = recentFoods.slice(0, 10);
                    break;
                case 'favorites':
                    filteredFoods = favoriteFoods.slice(0, 10);
                    break;
                case 'high-protein':
                    filteredFoods = FOOD_DATABASE.filter(food => food.protein >= 15).slice(0, 10);
                    break;
                case 'low-carb':
                    filteredFoods = FOOD_DATABASE.filter(food => food.carbs <= 10).slice(0, 10);
                    break;
                case 'keto-friendly':
                    filteredFoods = FOOD_DATABASE.filter(food => food.keto === true).slice(0, 10);
                    break;
                case 'vegan':
                    filteredFoods = FOOD_DATABASE.filter(food => food.vegan === true).slice(0, 10);
                    break;
            }
            
            if (filteredFoods.length === 0) {
                showAlert(`No ${filter} foods found`, 'info');
                return;
            }
            
            // Display results in search results area
            const searchResults = document.getElementById('search-results');
            searchResults.innerHTML = filteredFoods.map(food => `
                <div class="p-3 hover:bg-gray-50 cursor-pointer border-b border-gray-100 last:border-b-0" 
                     onclick="selectFood(${food.id})">
                    <div class="flex justify-between items-start">
                        <div>
                            <div class="font-medium">${food.name}</div>
                            <div class="text-sm text-gray-500">${food.brand} ‚Ä¢ ${food.category}</div>
                        </div>
                        <div class="text-right text-sm">
                            <div class="font-medium">${food.calories} cal</div>
                            <div class="text-gray-500">${food.protein}g protein</div>
                        </div>
                    </div>
                </div>
            `).join('');
            
            searchResults.classList.remove('hidden');
            document.getElementById('food-search').focus();
        }
        
        // ===== PLACEHOLDER FUNCTIONS FOR ADVANCED FEATURES =====
        
        function openBarcodeScanner() {
            showModal('üì± Barcode Scanner', `
                <div class="text-center py-8">
                    <div class="text-6xl mb-4">üì±</div>
                    <h3 class="text-xl font-semibold mb-4">Barcode Scanner</h3>
                    <p class="mb-4">Scan product barcodes for instant food identification and logging.</p>
                    <div class="bg-gray-100 rounded-lg p-8 mb-4">
                        <div class="text-4xl mb-2">üì∑</div>
                        <p class="text-sm text-gray-600">Camera interface would appear here</p>
                    </div>
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Or enter barcode manually: 123456789012" id="manual-barcode">
                    </div>
                    <button class="btn btn-primary" onclick="simulateBarcodeScan()">Simulate Scan</button>
                </div>
            `);
        }
        
        function openPhotoLogger() {
            showModal('üì∑ Photo Food Logger', `
                <div class="text-center py-8">
                    <div class="text-6xl mb-4">üì∑</div>
                    <h3 class="text-xl font-semibold mb-4">AI Photo Food Logger</h3>
                    <p class="mb-4">Take a photo of your meal for automatic food recognition and portion estimation.</p>
                    <div class="bg-gray-100 rounded-lg p-8 mb-4">
                        <input type="file" accept="image/*" id="food-photo" class="hidden" onchange="simulatePhotoAnalysis()">
                        <div class="text-4xl mb-2" onclick="document.getElementById('food-photo').click()" style="cursor: pointer;">üì∏</div>
                        <p class="text-sm text-gray-600">Click to take/upload photo</p>
                    </div>
                    <div id="photo-analysis" class="hidden">
                        <div class="alert alert-success">
                            <strong>AI Analysis Complete!</strong><br>
                            Detected: Grilled chicken (120g), Brown rice (80g), Broccoli (60g)
                        </div>
                        <button class="btn btn-success" onclick="addPhotoFoods()">Add to Food Log</button>
                    </div>
                </div>
            `);
        }
        
        function startVoiceInput() {
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                showModal('üé§ Voice Input', `
                    <div class="text-center py-8">
                        <div class="text-6xl mb-4">üé§</div>
                        <h3 class="text-xl font-semibold mb-4">Voice Food Logger</h3>
                        <p class="mb-4">Say what you ate and we'll find it for you!</p>
                        <div class="bg-gray-100 rounded-lg p-8 mb-4">
                            <div class="text-4xl mb-2">üéôÔ∏è</div>
                            <p class="text-sm text-gray-600">Click start and say something like "I ate a banana"</p>
                        </div>
                        <button class="btn btn-primary" onclick="startListening()" id="voice-start-btn">Start Listening</button>
                        <div id="voice-result" class="mt-4 hidden"></div>
                    </div>
                `);
            } else {
                showAlert('Voice recognition not supported in this browser', 'warning');
            }
        }
        
        function openRestaurantDB() {
            const restaurantOptions = Object.keys(RESTAURANT_DATABASE).map(key => 
                `<option value="${key}">${RESTAURANT_DATABASE[key].name}</option>`
            ).join('');
            
            showModal('üçΩÔ∏è Restaurant Database', `
                <div class="py-4">
                    <h3 class="text-xl font-semibold mb-4">Chain Restaurant Foods</h3>
                    <div class="form-group">
                        <label for="restaurant-select" class="form-label">Select Restaurant:</label>
                        <select class="form-control" id="restaurant-select" onchange="loadRestaurantItems()">
                            <option value="">Choose a restaurant...</option>
                            ${restaurantOptions}
                        </select>
                    </div>
                    <div id="restaurant-items" class="mt-4"></div>
                </div>
            `);
        }
        
        // Additional helper functions
        function simulateBarcodeScan() {
            const barcode = document.getElementById('manual-barcode').value || '123456789012';
            closeModal();
            // Simulate finding a random food
            const randomFood = FOOD_DATABASE[Math.floor(Math.random() * FOOD_DATABASE.length)];
            selectFood(randomFood.id);
            showAlert(`Barcode scanned: ${randomFood.name}`, 'success');
        }
        
        function simulatePhotoAnalysis() {
            setTimeout(() => {
                document.getElementById('photo-analysis').classList.remove('hidden');
            }, 2000);
        }
        
        function addPhotoFoods() {
            closeModal();
            showAlert('Photo foods would be added to log', 'success');
        }
        
        function loadRestaurantItems() {
            const restaurantKey = document.getElementById('restaurant-select').value;
            if (!restaurantKey) return;
            
            const restaurant = RESTAURANT_DATABASE[restaurantKey];
            const itemsHTML = restaurant.items.map(item => `
                <div class="bg-gray-50 p-3 rounded-lg mb-2 flex justify-between items-center">
                    <div>
                        <div class="font-medium">${item.name}</div>
                        <div class="text-sm text-gray-600">${item.calories} cal ‚Ä¢ ${item.protein}g protein</div>
                    </div>
                    <button class="btn btn-primary btn-sm" onclick="addRestaurantItem('${item.name}', ${item.calories}, ${item.protein}, ${item.carbs}, ${item.fat})">
                        Add
                    </button>
                </div>
            `).join('');
            
            document.getElementById('restaurant-items').innerHTML = itemsHTML;
        }
        
        function addRestaurantItem(name, calories, protein, carbs, fat) {
            // Create a temporary food object and add to log
            const restaurantFood = {
                id: Date.now(),
                name: name,
                brand: 'Restaurant',
                category: 'restaurant',
                calories: calories,
                protein: protein,
                carbs: carbs,
                fat: fat,
                fiber: 2,
                sugar: 0,
                sodium: 500,
                cholesterol: 50,
                serving: '1 serving'
            };
            
            // Add to temporary database for this session
            FOOD_DATABASE.push(restaurantFood);
            
            closeModal();
            selectFood(restaurantFood.id);
            showAlert(`${name} ready to log!`, 'success');
        }
        
        function startListening() {
            if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) return;
            
            const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
            const btn = document.getElementById('voice-start-btn');
            const result = document.getElementById('voice-result');
            
            btn.textContent = 'Listening...';
            btn.disabled = true;
            
            recognition.onresult = function(event) {
                const transcript = event.results[0][0].transcript;
                result.innerHTML = `
                    <div class="alert alert-info">
                        <strong>You said:</strong> "${transcript}"<br>
                        <button class="btn btn-success btn-sm mt-2" onclick="searchVoiceTranscript('${transcript}')">Search for this food</button>
                    </div>
                `;
                result.classList.remove('hidden');
            };
            
            recognition.onend = function() {
                btn.textContent = 'Start Listening';
                btn.disabled = false;
            };
            
            recognition.start();
        }
        
        function searchVoiceTranscript(transcript) {
            closeModal();
            document.getElementById('food-search').value = transcript;
            searchFoods(transcript);
        }
        
        // Add to favorites functionality
        function addToFavorites() {
            if (!selectedFood) return;
            
            const favoriteIcon = document.getElementById('favorite-icon');
            const isFavorite = favoriteFoods.some(f => f.id === selectedFood.id);
            
            if (isFavorite) {
                // Remove from favorites
                favoriteFoods = favoriteFoods.filter(f => f.id !== selectedFood.id);
                favoriteIcon.textContent = '‚ô°';
                showAlert('Removed from favorites', 'info');
            } else {
                // Add to favorites
                favoriteFoods.push(selectedFood);
                favoriteIcon.textContent = '‚ô•';
                showAlert('Added to favorites', 'success');
            }
            
            localStorage.setItem('favoriteFoods', JSON.stringify(favoriteFoods));
        }
        
        // Additional utility functions
        function clearTodayLog() {
            if (confirm('Are you sure you want to clear today\'s food log?')) {
                todaysFoodLog = [];
                displayTodaysLog();
                updateNutritionSummary();
                updateDashboard();
                saveFoodData();
                showAlert('Food log cleared', 'success');
            }
        }
        
        function exportFoodLog() {
            const today = new Date().toISOString().split('T')[0];
            const exportData = {
                date: today,
                foods: todaysFoodLog,
                totals: todaysFoodLog.reduce((acc, entry) => {
                    acc.calories += entry.calories;
                    acc.protein += entry.protein;
                    acc.carbs += entry.carbs;
                    acc.fat += entry.fat;
                    return acc;
                }, { calories: 0, protein: 0, carbs: 0, fat: 0 })
            };
            
            const dataStr = JSON.stringify(exportData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `food-log-${today}.json`;
            link.click();
            
            showAlert('Food log exported successfully!', 'success');
        }
        
        function openAdvancedSearch() {
            showModal('‚öôÔ∏è Advanced Food Search', `
                <div class="py-4">
                    <div class="grid grid-cols-2 gap-4">
                        <div class="form-group">
                            <label class="form-label">Category:</label>
                            <select class="form-control" id="search-category">
                                <option value="">All Categories</option>
                                <option value="fruit">Fruits</option>
                                <option value="vegetable">Vegetables</option>
                                <option value="protein">Proteins</option>
                                <option value="grain">Grains</option>
                                <option value="dairy">Dairy</option>
                                <option value="nuts">Nuts & Seeds</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Max Calories:</label>
                            <input type="number" class="form-control" id="search-max-calories" placeholder="500">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Min Protein (g):</label>
                            <input type="number" class="form-control" id="search-min-protein" placeholder="10">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Dietary:</label>
                            <select class="form-control" id="search-dietary">
                                <option value="">Any</option>
                                <option value="vegan">Vegan</option>
                                <option value="keto">Keto Friendly</option>
                            </select>
                        </div>
                    </div>
                    <button class="btn btn-primary w-full" onclick="performAdvancedSearch()">Search Foods</button>
                    <div id="advanced-search-results" class="mt-4"></div>
                </div>
            `);
        }
        
        function performAdvancedSearch() {
            const category = document.getElementById('search-category').value;
            const maxCalories = parseInt(document.getElementById('search-max-calories').value) || 10000;
            const minProtein = parseFloat(document.getElementById('search-min-protein').value) || 0;
            const dietary = document.getElementById('search-dietary').value;
            
            let results = FOOD_DATABASE.filter(food => {
                if (category && food.category !== category) return false;
                if (food.calories > maxCalories) return false;
                if (food.protein < minProtein) return false;
                if (dietary === 'vegan' && !food.vegan) return false;
                if (dietary === 'keto' && !food.keto) return false;
                return true;
            });
            
            const resultsHTML = results.slice(0, 20).map(food => `
                <div class="bg-gray-50 p-3 rounded-lg mb-2 flex justify-between items-center">
                    <div>
                        <div class="font-medium">${food.name}</div>
                        <div class="text-sm text-gray-600">${food.calories} cal ‚Ä¢ ${food.protein}g protein ‚Ä¢ ${food.category}</div>
                    </div>
                    <button class="btn btn-primary btn-sm" onclick="selectFood(${food.id}); closeModal();">
                        Select
                    </button>
                </div>
            `).join('');
            
            document.getElementById('advanced-search-results').innerHTML = resultsHTML || '<p class="text-gray-500 text-center">No foods match your criteria</p>';
        }
        
        // ===== CSS ANIMATIONS =====
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            
            @keyframes slideOut {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(100%); opacity: 0; }
            }
        `;
        document.head.appendChild(style);
        
        // ===== ENHANCED APPLICATION INITIALIZATION =====
        
        // Initialize app when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', function() {
                initializeApp();
                loadTodaysFoodData();
                displayTodaysLog();
                updateNutritionSummary();
            });
        } else {
            initializeApp();
            loadTodaysFoodData();
            displayTodaysLog();
            updateNutritionSummary();
        }
        
        // Close search results when clicking outside
        document.addEventListener('click', function(event) {
            if (!event.target.closest('#food-search') && !event.target.closest('#search-results')) {
                document.getElementById('search-results').classList.add('hidden');
            }
        });
        
        // Performance monitoring
        window.addEventListener('load', function() {
            if ('performance' in window) {
                const loadTime = performance.timing.loadEventEnd - performance.timing.navigationStart;
                console.log(`${CONFIG.appName} loaded in ${loadTime}ms`);
            }
        });
        
        // ===== MEAL PLANNING FUNCTIONS =====
        
        // Meal planning state
        let currentWeek = new Date();
        let mealPlans = {};
        let mealPreferences = {
            dietType: 'balanced',
            budget: 'moderate',
            cookingSkill: 'intermediate',
            allergies: ['gluten', 'dairy'],
            calorieTarget: 2000,
            proteinTarget: 150,
            mealCount: 3
        };
        
        // Recipe database with AI-generated suggestions
        const RECIPE_DATABASE = [
            {
                id: 1,
                name: 'Mediterranean Quinoa Bowl',
                emoji: 'ü•ó',
                time: 25,
                difficulty: 'Easy',
                calories: 480,
                protein: 18,
                carbs: 65,
                tags: ['Mediterranean', 'Vegetarian', 'High-Protein'],
                ingredients: ['quinoa', 'chickpeas', 'cucumber', 'tomatoes', 'feta', 'olive oil', 'lemon'],
                cost: 3.50,
                prepTime: 15,
                cookTime: 10
            },
            {
                id: 2,
                name: 'Grilled Salmon with Sweet Potato',
                emoji: 'üêü',
                time: 30,
                difficulty: 'Medium',
                calories: 520,
                protein: 45,
                carbs: 28,
                tags: ['Keto-Friendly', 'High-Protein', 'Omega-3'],
                ingredients: ['salmon', 'sweet potato', 'asparagus', 'garlic', 'herbs'],
                cost: 8.50,
                prepTime: 10,
                cookTime: 20
            },
            {
                id: 3,
                name: 'Veggie Stir-Fry with Tofu',
                emoji: 'ü•¨',
                time: 20,
                difficulty: 'Easy',
                calories: 380,
                protein: 22,
                carbs: 35,
                tags: ['Vegan', 'Quick', 'Asian'],
                ingredients: ['tofu', 'broccoli', 'bell peppers', 'soy sauce', 'ginger', 'brown rice'],
                cost: 4.25,
                prepTime: 15,
                cookTime: 5
            },
            {
                id: 4,
                name: 'Chicken & Avocado Wrap',
                emoji: 'üåØ',
                time: 15,
                difficulty: 'Easy',
                calories: 420,
                protein: 32,
                carbs: 28,
                tags: ['High-Protein', 'Quick', 'Portable'],
                ingredients: ['chicken breast', 'avocado', 'spinach', 'tomato', 'whole wheat tortilla'],
                cost: 5.50,
                prepTime: 15,
                cookTime: 0
            },
            {
                id: 5,
                name: 'Lentil Power Bowl',
                emoji: 'üç≤',
                time: 35,
                difficulty: 'Easy',
                calories: 450,
                protein: 20,
                carbs: 72,
                tags: ['Vegan', 'High-Fiber', 'Budget-Friendly'],
                ingredients: ['red lentils', 'kale', 'sweet potato', 'tahini', 'pumpkin seeds'],
                cost: 2.75,
                prepTime: 10,
                cookTime: 25
            },
            {
                id: 6,
                name: 'Greek Yogurt Parfait',
                emoji: 'ü•£',
                time: 10,
                difficulty: 'Easy',
                calories: 280,
                protein: 20,
                carbs: 35,
                tags: ['Breakfast', 'High-Protein', 'Probiotic'],
                ingredients: ['greek yogurt', 'berries', 'granola', 'honey', 'almonds'],
                cost: 3.25,
                prepTime: 10,
                cookTime: 0
            }
        ];
        
        /**
         * Initialize meal planner
         */
        function initializeMealPlanner() {
            generateWeeklyPlan();
            renderRecipeSuggestions();
            updateGroceryList();
            updateMealPlanStats();
        }
        
        /**
         * Generate AI-powered meal plan
         */
        function generateMealPlan() {
            showAlert('Generating personalized meal plan...', 'info');
            
            // Simulate AI processing
            setTimeout(() => {
                generateWeeklyPlan();
                renderRecipeSuggestions();
                updateGroceryList();
                updateMealPlanStats();
                showAlert('New meal plan generated successfully!', 'success');
            }, 1500);
        }
        
        /**
         * Generate weekly meal plan based on preferences
         */
        function generateWeeklyPlan() {
            const days = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'];
            const meals = ['Breakfast', 'Lunch', 'Dinner'];
            
            let planHTML = '<div class="meal-plan-grid" style="grid-template-columns: repeat(7, 1fr);">';
            
            days.forEach((day, dayIndex) => {
                planHTML += `
                    <div class="day-column">
                        <div class="day-header">${day}</div>
                `;
                
                meals.forEach((meal, mealIndex) => {
                    const mealKey = `${day}-${meal}`;
                    const assignedMeal = getRandomMealForSlot(meal);
                    
                    if (assignedMeal) {
                        planHTML += `
                            <div class="meal-slot filled" onclick="changeMeal('${mealKey}')">
                                <div class="meal-card">
                                    <div class="meal-name">${assignedMeal.name}</div>
                                    <div class="meal-stats">
                                        <span class="meal-calories">${assignedMeal.calories} cal</span>
                                        <span>${assignedMeal.protein}g protein</span>
                                    </div>
                                </div>
                            </div>
                        `;
                        mealPlans[mealKey] = assignedMeal;
                    } else {
                        planHTML += `
                            <div class="meal-slot" onclick="selectMealFromSuggestions('${mealKey}')">
                                <div style="color: var(--text-secondary); font-size: 0.875rem; text-align: center;">
                                    <div>üìã</div>
                                    <div>Add ${meal}</div>
                                </div>
                            </div>
                        `;
                    }
                });
                
                planHTML += '</div>';
            });
            
            planHTML += '</div>';
            document.getElementById('weekly-meal-plan').innerHTML = planHTML;
        }
        
        /**
         * Get random meal suggestion for specific meal slot
         */
        function getRandomMealForSlot(mealType) {
            let filteredRecipes = RECIPE_DATABASE.filter(recipe => {
                // Filter based on meal type and dietary preferences
                if (mealType === 'Breakfast') {
                    return recipe.tags.includes('Breakfast') || recipe.calories < 350;
                }
                if (mealType === 'Lunch') {
                    return recipe.calories >= 350 && recipe.calories <= 550;
                }
                if (mealType === 'Dinner') {
                    return recipe.calories >= 400;
                }
                return true;
            });
            
            // Apply dietary filters
            if (mealPreferences.dietType === 'vegan') {
                filteredRecipes = filteredRecipes.filter(recipe => recipe.tags.includes('Vegan'));
            } else if (mealPreferences.dietType === 'keto') {
                filteredRecipes = filteredRecipes.filter(recipe => recipe.tags.includes('Keto-Friendly'));
            }
            
            // Apply budget filters
            if (mealPreferences.budget === 'budget') {
                filteredRecipes = filteredRecipes.filter(recipe => recipe.cost <= 4);
            } else if (mealPreferences.budget === 'luxury') {
                filteredRecipes = filteredRecipes.filter(recipe => recipe.cost >= 6);
            }
            
            return filteredRecipes[Math.floor(Math.random() * filteredRecipes.length)];
        }
        
        /**
         * Render AI recipe suggestions
         */
        function renderRecipeSuggestions() {
            const suggestionsHTML = RECIPE_DATABASE.map(recipe => `
                <div class="recipe-card" onclick="showRecipeDetails(${recipe.id})">
                    <div class="recipe-image">
                        ${recipe.emoji}
                    </div>
                    <div class="recipe-content">
                        <h3 class="recipe-title">${recipe.name}</h3>
                        <div class="recipe-meta">
                            <span class="recipe-time">‚è±Ô∏è ${recipe.time} min</span>
                            <span class="recipe-difficulty">${recipe.difficulty}</span>
                        </div>
                        <div class="recipe-nutrition">
                            <div class="nutrition-item">
                                <div class="nutrition-value">${recipe.calories}</div>
                                <div class="nutrition-label">Calories</div>
                            </div>
                            <div class="nutrition-item">
                                <div class="nutrition-value">${recipe.protein}g</div>
                                <div class="nutrition-label">Protein</div>
                            </div>
                            <div class="nutrition-item">
                                <div class="nutrition-value">$${recipe.cost}</div>
                                <div class="nutrition-label">Cost</div>
                            </div>
                        </div>
                        <div class="recipe-tags">
                            ${recipe.tags.map(tag => `<span class="recipe-tag">${tag}</span>`).join('')}
                        </div>
                    </div>
                </div>
            `).join('');
            
            document.getElementById('recipe-suggestions').innerHTML = suggestionsHTML;
        }
        
        /**
         * Update grocery list based on meal plan
         */
        function updateGroceryList() {
            const groceryItems = {};
            
            // Collect ingredients from planned meals
            Object.values(mealPlans).forEach(meal => {
                meal.ingredients.forEach(ingredient => {
                    groceryItems[ingredient] = (groceryItems[ingredient] || 0) + 1;
                });
            });
            
            // Categorize grocery items
            const categories = {
                'Proteins': ['chicken breast', 'salmon', 'tofu', 'chickpeas', 'lentils', 'eggs', 'greek yogurt'],
                'Vegetables': ['broccoli', 'spinach', 'kale', 'bell peppers', 'tomatoes', 'cucumber', 'asparagus'],
                'Fruits': ['berries', 'avocado', 'lemon', 'apple', 'banana'],
                'Grains & Starches': ['quinoa', 'brown rice', 'sweet potato', 'whole wheat tortilla', 'granola'],
                'Pantry Items': ['olive oil', 'soy sauce', 'tahini', 'honey', 'herbs', 'spices', 'garlic', 'ginger'],
                'Dairy & Alternatives': ['feta', 'almonds', 'pumpkin seeds']
            };
            
            let groceryHTML = '';
            
            Object.entries(categories).forEach(([category, items]) => {
                const categoryItems = items.filter(item => groceryItems[item]);
                if (categoryItems.length > 0) {
                    groceryHTML += `
                        <div class="grocery-category">
                            <div class="category-header">
                                <div class="category-title">
                                    <span>${getCategoryEmoji(category)}</span>
                                    ${category}
                                </div>
                                <div class="category-count">${categoryItems.length}</div>
                            </div>
                            ${categoryItems.map(item => `
                                <div class="grocery-item">
                                    <div class="item-info">
                                        <input type="checkbox" class="item-checkbox" id="item-${item}" 
                                               onchange="toggleGroceryItem('${item}')">
                                        <span class="item-name">${item.charAt(0).toUpperCase() + item.slice(1)}</span>
                                        <span class="item-amount">${groceryItems[item]}x</span>
                                    </div>
                                    <span class="item-price">$${(Math.random() * 5 + 1).toFixed(2)}</span>
                                </div>
                            `).join('')}
                        </div>
                    `;
                }
            });
            
            document.getElementById('grocery-list').innerHTML = groceryHTML;
        }
        
        /**
         * Get emoji for grocery category
         */
        function getCategoryEmoji(category) {
            const emojis = {
                'Proteins': 'ü•©',
                'Vegetables': 'ü•¨',
                'Fruits': 'üçé',
                'Grains & Starches': 'üåæ',
                'Pantry Items': 'ü´ô',
                'Dairy & Alternatives': 'ü•õ'
            };
            return emojis[category] || 'üì¶';
        }
        
        /**
         * Update meal planning statistics
         */
        function updateMealPlanStats() {
            const plannedMeals = Object.values(mealPlans);
            const totalCalories = plannedMeals.reduce((sum, meal) => sum + meal.calories, 0);
            const totalCost = plannedMeals.reduce((sum, meal) => sum + meal.cost, 0);
            const avgPrepTime = plannedMeals.reduce((sum, meal) => sum + meal.time, 0) / plannedMeals.length || 0;
            
            document.getElementById('weekly-calories').textContent = totalCalories.toLocaleString();
            document.getElementById('planned-meals').textContent = plannedMeals.length;
            document.getElementById('grocery-cost').textContent = `$${totalCost.toFixed(0)}`;
            document.getElementById('prep-time').textContent = `${(avgPrepTime * plannedMeals.length / 60).toFixed(1)}h`;
        }
        
        /**
         * Update meal preferences
         */
        function updateMealPreferences() {
            mealPreferences.dietType = document.getElementById('diet-type').value;
            mealPreferences.budget = document.getElementById('budget-range').value;
            mealPreferences.cookingSkill = document.getElementById('cooking-skill').value;
            
            // Regenerate plan with new preferences
            generateWeeklyPlan();
            updateMealPlanStats();
        }
        
        /**
         * Show recipe details modal
         */
        function showRecipeDetails(recipeId) {
            const recipe = RECIPE_DATABASE.find(r => r.id === recipeId);
            if (!recipe) return;
            
            showModal(`${recipe.emoji} ${recipe.name}`, `
                <div class="recipe-details">
                    <div class="grid grid-3 mb-4">
                        <div class="text-center">
                            <div class="text-2xl font-bold text-primary">${recipe.time}</div>
                            <div class="text-sm text-muted">Minutes</div>
                        </div>
                        <div class="text-center">
                            <div class="text-2xl font-bold text-success">${recipe.calories}</div>
                            <div class="text-sm text-muted">Calories</div>
                        </div>
                        <div class="text-center">
                            <div class="text-2xl font-bold text-warning">$${recipe.cost}</div>
                            <div class="text-sm text-muted">Cost</div>
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <h4 class="font-semibold mb-2">Ingredients:</h4>
                        <div class="ingredient-list">
                            ${recipe.ingredients.map(ingredient => `
                                <span class="tag">${ingredient}</span>
                            `).join('')}
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <h4 class="font-semibold mb-2">Tags:</h4>
                        <div class="recipe-tags">
                            ${recipe.tags.map(tag => `<span class="recipe-tag">${tag}</span>`).join('')}
                        </div>
                    </div>
                    
                    <div class="button-group">
                        <button class="btn btn-primary" onclick="addToMealPlan(${recipe.id})">üìÖ Add to Plan</button>
                        <button class="btn btn-outline" onclick="addToFavorites(${recipe.id})">‚ù§Ô∏è Favorite</button>
                        <button class="btn btn-outline" onclick="shareRecipe(${recipe.id})">üì§ Share</button>
                    </div>
                </div>
            `);
        }
        
        /**
         * Export meal plan
         */
        function exportMealPlan() {
            const plannedMeals = Object.entries(mealPlans);
            let exportData = "Weekly Meal Plan\\n\\n";
            
            const days = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'];
            days.forEach(day => {
                exportData += `${day.toUpperCase()}\\n`;
                const dayMeals = plannedMeals.filter(([key]) => key.startsWith(day));
                dayMeals.forEach(([key, meal]) => {
                    const mealType = key.split('-')[1];
                    exportData += `  ${mealType}: ${meal.name} (${meal.calories} cal)\\n`;
                });
                exportData += "\\n";
            });
            
            // Create downloadable file
            const blob = new Blob([exportData], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'weekly-meal-plan.txt';
            a.click();
            URL.revokeObjectURL(url);
            
            showAlert('Meal plan exported successfully!', 'success');
        }
        
        /**
         * Export grocery list
         */
        function exportGroceryList() {
            const groceryItems = document.querySelectorAll('.grocery-item');
            let exportData = "Smart Grocery List\\n\\n";
            
            groceryItems.forEach(item => {
                const name = item.querySelector('.item-name').textContent;
                const amount = item.querySelector('.item-amount').textContent;
                const price = item.querySelector('.item-price').textContent;
                exportData += `‚ñ° ${name} ${amount} - ${price}\\n`;
            });
            
            // Create downloadable file
            const blob = new Blob([exportData], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'grocery-list.txt';
            a.click();
            URL.revokeObjectURL(url);
            
            showAlert('Grocery list sent to downloads!', 'success');
        }
        
        // Placeholder functions for additional features
        function showMealPlanSettings() {
            showModal('‚öôÔ∏è Meal Plan Settings', `
                <div class="space-y-4">
                    <div class="form-group">
                        <label class="form-label">Daily Calorie Target</label>
                        <input type="number" class="form-input" value="${mealPreferences.calorieTarget}" id="calorie-target">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Daily Protein Target (g)</label>
                        <input type="number" class="form-input" value="${mealPreferences.proteinTarget}" id="protein-target">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Meals per Day</label>
                        <select class="form-input" id="meal-count">
                            <option value="2" ${mealPreferences.mealCount === 2 ? 'selected' : ''}>2 meals</option>
                            <option value="3" ${mealPreferences.mealCount === 3 ? 'selected' : ''}>3 meals</option>
                            <option value="4" ${mealPreferences.mealCount === 4 ? 'selected' : ''}>3 meals + snack</option>
                            <option value="5" ${mealPreferences.mealCount === 5 ? 'selected' : ''}>5 small meals</option>
                        </select>
                    </div>
                    <button class="btn btn-primary w-full" onclick="saveMealSettings()">Save Settings</button>
                </div>
            `);
        }
        
        function removeAllergy(allergy) {
            mealPreferences.allergies = mealPreferences.allergies.filter(a => a !== allergy);
            // Re-render the allergies display
            location.reload(); // Simple refresh for demo
        }
        
        function refreshRecipes() {
            showAlert('Refreshing AI recipe suggestions...', 'info');
            setTimeout(() => {
                renderRecipeSuggestions();
                showAlert('New recipe suggestions loaded!', 'success');
            }, 1000);
        }
        
        function optimizeGroceryList() {
            showAlert('Optimizing grocery list by store layout...', 'info');
            setTimeout(() => {
                updateGroceryList();
                showAlert('Grocery list optimized for efficient shopping!', 'success');
            }, 1500);
        }
        
        function prevWeek() {
            currentWeek.setDate(currentWeek.getDate() - 7);
            generateWeeklyPlan();
            showAlert('Viewing previous week', 'info');
        }
        
        function nextWeek() {
            currentWeek.setDate(currentWeek.getDate() + 7);
            generateWeeklyPlan();
            showAlert('Viewing next week', 'info');
        }
        
        function toggleGroceryItem(item) {
            console.log(`Toggled grocery item: ${item}`);
        }
        
        function addToMealPlan(recipeId) {
            const recipe = RECIPE_DATABASE.find(r => r.id === recipeId);
            showAlert(`${recipe.name} added to meal plan!`, 'success');
            closeModal();
        }
        
        function addToFavorites(recipeId) {
            const recipe = RECIPE_DATABASE.find(r => r.id === recipeId);
            showAlert(`${recipe.name} added to favorites!`, 'success');
        }
        
        function shareRecipe(recipeId) {
            const recipe = RECIPE_DATABASE.find(r => r.id === recipeId);
            if (navigator.share) {
                navigator.share({
                    title: recipe.name,
                    text: `Check out this healthy recipe: ${recipe.name}`,
                    url: window.location.href
                });
            } else {
                showAlert('Recipe link copied to clipboard!', 'success');
            }
        }
        
        // ===== ANALYTICS & PROGRESS TRACKING FUNCTIONS =====
        
        // Analytics state
        let analyticsData = {
            timeframe: 'month',
            weightHistory: [
                { date: '2024-01-01', weight: 175.8, bodyFat: 18.2 },
                { date: '2024-01-15', weight: 174.3, bodyFat: 17.9 },
                { date: '2024-02-01', weight: 173.1, bodyFat: 17.5 },
                { date: '2024-02-15', weight: 172.6, bodyFat: 17.2 }
            ],
            calorieHistory: [],
            habits: {
                hydration: { current: 2600, target: 3000, streak: 23 },
                steps: { current: 7634, target: 10000, streak: 18 },
                veggies: { current: 5, target: 5, streak: 12 },
                sleep: { rating: 4, duration: 7.75, streak: 8.2 }
            }
        };
        
        /**
         * Initialize analytics dashboard
         */
        function initializeAnalytics() {
            generateSampleData();
            renderWeightChart();
            renderCalorieChart();
            updateAnalyticsMetrics();
            updateHabitCards();
        }
        
        /**
         * Generate sample data for demonstration
         */
        function generateSampleData() {
            const days = 30;
            const today = new Date();
            analyticsData.calorieHistory = [];
            
            for (let i = days; i >= 0; i--) {
                const date = new Date(today);
                date.setDate(date.getDate() - i);
                const baseCalories = 1800 + Math.random() * 400;
                analyticsData.calorieHistory.push({
                    date: date.toISOString().split('T')[0],
                    calories: Math.round(baseCalories),
                    protein: Math.round(baseCalories * 0.08),
                    carbs: Math.round(baseCalories * 0.5 / 4),
                    fat: Math.round(baseCalories * 0.3 / 9)
                });
            }
        }
        
        /**
         * Change analytics timeframe
         */
        function changeTimeframe(timeframe) {
            analyticsData.timeframe = timeframe;
            
            // Update active button
            document.querySelectorAll('[onclick*="changeTimeframe"]').forEach(btn => {
                btn.classList.remove('active');
            });
            document.getElementById(`btn-${timeframe}`).classList.add('active');
            
            // Update charts and metrics
            renderWeightChart();
            renderCalorieChart();
            updateAnalyticsMetrics();
            
            showAlert(`Switched to ${timeframe} view`, 'info');
        }
        
        /**
         * Render weight chart (simulated)
         */
        function renderWeightChart() {
            const canvas = document.getElementById('weight-chart');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Simple chart simulation
            ctx.strokeStyle = '#3B82F6';
            ctx.lineWidth = 3;
            ctx.beginPath();
            
            const data = analyticsData.weightHistory;
            const width = canvas.width - 40;
            const height = canvas.height - 40;
            
            data.forEach((point, index) => {
                const x = 20 + (index / (data.length - 1)) * width;
                const y = height - ((point.weight - 165) / 15) * height + 20;
                
                if (index === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            });
            
            ctx.stroke();
            
            // Add data points
            ctx.fillStyle = '#3B82F6';
            data.forEach((point, index) => {
                const x = 20 + (index / (data.length - 1)) * width;
                const y = height - ((point.weight - 165) / 15) * height + 20;
                ctx.beginPath();
                ctx.arc(x, y, 4, 0, 2 * Math.PI);
                ctx.fill();
            });
            
            // Add labels
            ctx.fillStyle = '#6B7280';
            ctx.font = '12px system-ui';
            ctx.textAlign = 'center';
            ctx.fillText('Weight Progress', canvas.width / 2, 20);
        }
        
        /**
         * Render calorie chart (simulated)
         */
        function renderCalorieChart() {
            const canvas = document.getElementById('calorie-chart');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            const data = analyticsData.calorieHistory.slice(-7); // Last 7 days
            const width = canvas.width - 40;
            const height = canvas.height - 60;
            const barWidth = width / data.length - 10;
            
            data.forEach((day, index) => {
                const x = 20 + index * (width / data.length);
                const barHeight = (day.calories / 2500) * height;
                const y = height - barHeight + 20;
                
                // Color based on target achievement
                if (day.calories < 1800) {
                    ctx.fillStyle = '#10B981'; // Under target - green
                } else if (day.calories > 2200) {
                    ctx.fillStyle = '#EF4444'; // Over target - red
                } else {
                    ctx.fillStyle = '#F59E0B'; // On target - amber
                }
                
                ctx.fillRect(x, y, barWidth, barHeight);
                
                // Add day labels
                ctx.fillStyle = '#6B7280';
                ctx.font = '10px system-ui';
                ctx.textAlign = 'center';
                const dayName = new Date(day.date).toLocaleDateString('en', { weekday: 'short' });
                ctx.fillText(dayName, x + barWidth / 2, height + 40);
            });
            
            // Add title
            ctx.fillStyle = '#6B7280';
            ctx.font = '12px system-ui';
            ctx.textAlign = 'center';
            ctx.fillText('Daily Calorie Intake', canvas.width / 2, 15);
        }
        
        /**
         * Update analytics metrics
         */
        function updateAnalyticsMetrics() {
            const recentData = analyticsData.calorieHistory.slice(-30);
            const avgCalories = recentData.reduce((sum, day) => sum + day.calories, 0) / recentData.length;
            const avgProtein = recentData.reduce((sum, day) => sum + day.protein, 0) / recentData.length;
            
            document.getElementById('avg-calories').textContent = Math.round(avgCalories).toLocaleString();
            document.getElementById('avg-protein').textContent = Math.round(avgProtein) + 'g';
        }
        
        /**
         * Show nutrition view (macros, micros, timing)
         */
        function showNutritionView(viewType) {
            // Hide all views
            document.querySelectorAll('.nutrition-view').forEach(view => {
                view.classList.add('hidden');
            });
            
            // Show selected view
            document.getElementById(`nutrition-${viewType}`).classList.remove('hidden');
            
            // Update active button
            document.querySelectorAll('[onclick*="showNutritionView"]').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
        }
        
        /**
         * Update habit tracking cards
         */
        function updateHabitCards() {
            // Update hydration
            const hydrationProgress = (analyticsData.habits.hydration.current / analyticsData.habits.hydration.target) * 100;
            document.querySelector('.habit-card:nth-child(1) .progress-fill').style.width = `${hydrationProgress}%`;
            
            // Update steps
            const stepsProgress = (analyticsData.habits.steps.current / analyticsData.habits.steps.target) * 100;
            document.querySelector('.habit-card:nth-child(2) .progress-fill').style.width = `${stepsProgress}%`;
        }
        
        /**
         * Generate analytics report
         */
        function generateReport() {
            showModal('üìÑ Analytics Report', `
                <div class="report-container">
                    <h3>Nutrition Analytics Report - ${analyticsData.timeframe}</h3>
                    <div class="report-section">
                        <h4>Key Metrics</h4>
                        <ul>
                            <li>Average Daily Calories: 1,847 kcal</li>
                            <li>Average Protein: 142g (95% of target)</li>
                            <li>Weight Change: -3.2 lbs</li>
                            <li>Goal Adherence: 78%</li>
                        </ul>
                    </div>
                    <div class="report-section">
                        <h4>Achievements</h4>
                        <ul>
                            <li>‚úÖ Maintained 23-day hydration streak</li>
                            <li>‚úÖ Exceeded protein target 18 consecutive days</li>
                            <li>‚úÖ Consistent meal timing</li>
                        </ul>
                    </div>
                    <div class="report-section">
                        <h4>Recommendations</h4>
                        <ul>
                            <li>üî∏ Increase calcium-rich foods</li>
                            <li>üî∏ Consider earlier dinner timing</li>
                            <li>üî∏ Add 200 daily calories to support goals</li>
                        </ul>
                    </div>
                    <div class="button-group mt-4">
                        <button class="btn btn-primary" onclick="exportReport()">üìß Email Report</button>
                        <button class="btn btn-outline" onclick="downloadReport()">üíæ Download PDF</button>
                    </div>
                </div>
            `);
        }
        
        /**
         * Add body measurement
         */
        function addBodyMeasurement() {
            showModal('‚öñÔ∏è Add Body Measurement', `
                <div class="measurement-form">
                    <div class="form-group">
                        <label class="form-label">Date</label>
                        <input type="date" class="form-input" value="${new Date().toISOString().split('T')[0]}" id="measurement-date">
                    </div>
                    <div class="grid grid-2">
                        <div class="form-group">
                            <label class="form-label">Weight (lbs)</label>
                            <input type="number" class="form-input" placeholder="172.6" id="measurement-weight" step="0.1">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Body Fat (%)</label>
                            <input type="number" class="form-input" placeholder="17.2" id="measurement-bf" step="0.1">
                        </div>
                    </div>
                    <div class="grid grid-2">
                        <div class="form-group">
                            <label class="form-label">Muscle Mass (lbs)</label>
                            <input type="number" class="form-input" placeholder="142.8" id="measurement-muscle" step="0.1">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Water (%)</label>
                            <input type="number" class="form-input" placeholder="58.3" id="measurement-water" step="0.1">
                        </div>
                    </div>
                    <button class="btn btn-primary w-full" onclick="saveMeasurement()">Save Measurement</button>
                </div>
            `);
        }
        
        /**
         * Log water intake
         */
        function logWater() {
            analyticsData.habits.hydration.current += 250;
            if (analyticsData.habits.hydration.current > analyticsData.habits.hydration.target) {
                analyticsData.habits.hydration.current = analyticsData.habits.hydration.target;
            }
            
            updateHabitCards();
            showAlert('Added 250ml water! üíß', 'success');
        }
        
        /**
         * Rate sleep quality
         */
        function rateSleep() {
            showModal('üò¥ Rate Your Sleep', `
                <div class="sleep-rating-form">
                    <h3>How was your sleep quality?</h3>
                    <div class="rating-stars" id="sleep-stars">
                        ${[1,2,3,4,5].map(i => `<span class="star" data-rating="${i}" onclick="selectSleepRating(${i})">‚òÜ</span>`).join('')}
                    </div>
                    <div class="form-group">
                        <label class="form-label">Sleep Duration</label>
                        <input type="time" class="form-input" value="07:45" id="sleep-duration">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Notes (optional)</label>
                        <textarea class="form-input" placeholder="How did you feel? Any factors affecting sleep?" id="sleep-notes"></textarea>
                    </div>
                    <button class="btn btn-primary w-full" onclick="saveSleepRating()">Save Sleep Rating</button>
                </div>
            `);
        }
        
        /**
         * Add new habit
         */
        function addNewHabit() {
            showModal('üéØ Add New Habit', `
                <div class="habit-form">
                    <div class="form-group">
                        <label class="form-label">Habit Name</label>
                        <input type="text" class="form-input" placeholder="e.g., Read 30 minutes daily" id="new-habit-name">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Category</label>
                        <select class="form-input" id="new-habit-category">
                            <option value="nutrition">Nutrition</option>
                            <option value="fitness">Fitness</option>
                            <option value="wellness">Wellness</option>
                            <option value="mindfulness">Mindfulness</option>
                        </select>
                    </div>
                    <div class="grid grid-2">
                        <div class="form-group">
                            <label class="form-label">Target Value</label>
                            <input type="number" class="form-input" placeholder="30" id="new-habit-target">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Unit</label>
                            <input type="text" class="form-input" placeholder="minutes" id="new-habit-unit">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Frequency</label>
                        <select class="form-input" id="new-habit-frequency">
                            <option value="daily">Daily</option>
                            <option value="weekly">Weekly</option>
                            <option value="monthly">Monthly</option>
                        </select>
                    </div>
                    <button class="btn btn-primary w-full" onclick="saveNewHabit()">Create Habit</button>
                </div>
            `);
        }
        
        /**
         * Refresh AI insights
         */
        function refreshInsights() {
            showAlert('Analyzing your nutrition data...', 'info');
            
            setTimeout(() => {
                showAlert('New insights generated based on recent data!', 'success');
                // In a real app, this would fetch new insights from the AI engine
            }, 2000);
        }
        
        // Placeholder functions for analytics features
        function updateCalorieChart(viewType) {
            showAlert(`Switched to ${viewType} view`, 'info');
            renderCalorieChart();
        }
        
        function viewHabitDetails(habitType) {
            showAlert(`Opening ${habitType} habit details...`, 'info');
        }
        
        function suggestCalciumFoods() {
            showModal('ü•õ Calcium-Rich Foods', `
                <div class="calcium-suggestions">
                    <h3>Recommended Calcium Sources</h3>
                    <div class="food-suggestions">
                        <div class="suggestion-item">
                            <strong>Greek Yogurt</strong> - 200mg per cup
                        </div>
                        <div class="suggestion-item">
                            <strong>Almonds</strong> - 246mg per oz
                        </div>
                        <div class="suggestion-item">
                            <strong>Sardines</strong> - 351mg per 3.75 oz
                        </div>
                        <div class="suggestion-item">
                            <strong>Kale</strong> - 177mg per cup
                        </div>
                        <div class="suggestion-item">
                            <strong>Cheese</strong> - 200-400mg per oz
                        </div>
                    </div>
                    <button class="btn btn-primary w-full" onclick="addCalciumFoodsToLog()">Add to Food Log</button>
                </div>
            `);
        }
        
        function dismissInsight(insightType) {
            event.target.closest('.insight-card').style.display = 'none';
            showAlert('Insight dismissed', 'info');
        }
        
        function suggestMealTiming() {
            showAlert('Generating optimal meal timing schedule...', 'info');
        }
        
        function setupHydrationReminders() {
            showAlert('Hydration reminders enabled!', 'success');
        }
        
        function shareAchievement(type) {
            if (navigator.share) {
                navigator.share({
                    title: 'Nutrition Achievement!',
                    text: `I've maintained my protein target for 18 consecutive days! üí™`,
                    url: window.location.href
                });
            } else {
                showAlert('Achievement shared!', 'success');
            }
        }
        
        function exportReport() {
            showAlert('Report sent to your email!', 'success');
            closeModal();
        }
        
        function downloadReport() {
            showAlert('Report downloaded as PDF!', 'success');
            closeModal();
        }
        
        function saveMeasurement() {
            const weight = document.getElementById('measurement-weight').value;
            const date = document.getElementById('measurement-date').value;
            
            if (weight && date) {
                analyticsData.weightHistory.push({
                    date: date,
                    weight: parseFloat(weight),
                    bodyFat: parseFloat(document.getElementById('measurement-bf').value || 0)
                });
                
                renderWeightChart();
                showAlert('Body measurement saved!', 'success');
                closeModal();
            } else {
                showAlert('Please enter weight and date', 'warning');
            }
        }
        
        function selectSleepRating(rating) {
            document.querySelectorAll('#sleep-stars .star').forEach((star, index) => {
                star.textContent = index < rating ? '‚òÖ' : '‚òÜ';
                star.style.color = index < rating ? '#F59E0B' : '#D1D5DB';
            });
            document.getElementById('sleep-stars').dataset.rating = rating;
        }
        
        function saveSleepRating() {
            const rating = document.getElementById('sleep-stars').dataset.rating || 5;
            analyticsData.habits.sleep.rating = parseInt(rating);
            showAlert(`Sleep rated ${rating}/5 stars!`, 'success');
            closeModal();
        }
        
        function saveNewHabit() {
            const name = document.getElementById('new-habit-name').value;
            if (name) {
                showAlert(`New habit "${name}" created!`, 'success');
                closeModal();
            } else {
                showAlert('Please enter habit name', 'warning');
            }
        }
        
        function addCalciumFoodsToLog() {
            showAlert('Calcium-rich foods added to today\'s log!', 'success');
            closeModal();
        }
        
        });
        
    </script>
</body>
</html>